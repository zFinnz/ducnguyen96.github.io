<!doctype html><html lang=vi-vn>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Microservices v·ªõi NodeJS ph·∫ßn 2 - m·ªôt mini-microservices app | Th·ªânh tho·∫£ng ƒë√¥i l·ªùi</title>
<link rel=canonical href=/posts/backend/microservices-with-node-p2/>
<meta name=description content="L√† n∆°i chia s·∫ª l·∫°i nh·ªØng ki·∫øn th·ª©c, kinh nghi·ªám m√¨nh ti·∫øp thu ƒë∆∞·ª£c trong qu√° tr√¨nh h·ªçc t·∫≠p v√† l√†m vi·ªác. V√† th·ªânh tho·∫£ng c≈©ng ƒëƒÉng m·ªôt v√†i demo ng·ªõ ng·∫©n n·ªØa :smile:">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="Microservices v·ªõi NodeJS ph·∫ßn 2 - m·ªôt mini-microservices app">
<meta property="og:description" content="·ªû b√†i tr∆∞·ªõc th√¨ ch√∫ng ta ƒë√£ th·∫•y m·ªôt v√†i notes v·ªÅ c√°ch ch√∫ng ta x·ª≠ l√Ω v·∫•n ƒë·ªÅ giao ti·∫øp gi·ªØa c√°c microservices, b√¢y gi·ªù th√¨ h√£y b·∫Øt ƒë·∫ßu vi·∫øt m·ªôt v√†i d√≤ng code n√†o üòÑ.
Gi·ªù ta s·∫Ω xem qua mock-up c·ªßa app m√† ch√∫ng ta s·∫Ω build ƒë·ªÉ c√≥ hi·ªÉu h∆°n v·ªÅ async communication. D∆∞·ªõi ƒë√¢y l√† m·ªôt v√†i ch√∫ √Ω v·ªÅ project ti·∫øp theo ch√∫ng ta s·∫Ω build.">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/backend/microservices-with-node-p2/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-09-10T00:00:00+00:00">
<meta property="article:modified_time" content="2021-09-10T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Microservices v·ªõi NodeJS ph·∫ßn 2 - m·ªôt mini-microservices app">
<meta name=twitter:description content="·ªû b√†i tr∆∞·ªõc th√¨ ch√∫ng ta ƒë√£ th·∫•y m·ªôt v√†i notes v·ªÅ c√°ch ch√∫ng ta x·ª≠ l√Ω v·∫•n ƒë·ªÅ giao ti·∫øp gi·ªØa c√°c microservices, b√¢y gi·ªù th√¨ h√£y b·∫Øt ƒë·∫ßu vi·∫øt m·ªôt v√†i d√≤ng code n√†o üòÑ.
Gi·ªù ta s·∫Ω xem qua mock-up c·ªßa app m√† ch√∫ng ta s·∫Ω build ƒë·ªÉ c√≥ hi·ªÉu h∆°n v·ªÅ async communication. D∆∞·ªõi ƒë√¢y l√† m·ªôt v√†i ch√∫ √Ω v·ªÅ project ti·∫øp theo ch√∫ng ta s·∫Ω build.">
<link rel=stylesheet href=/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=/images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=/posts/english/one-article-per-day/ aria-label=Previous>
<i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f" aria-label=Facebook>
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&text=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&is_video=false&description=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label=Pinterest>
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app&body=Check out this article: %2fposts%2fbackend%2fmicroservices-with-node-p2%2f" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&name=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app&description=%e1%bb%9e%20b%c3%a0i%20tr%c6%b0%e1%bb%9bc%20th%c3%ac%20ch%c3%bang%20ta%20%c4%91%c3%a3%20th%e1%ba%a5y%20m%e1%bb%99t%20v%c3%a0i%20notes%20v%e1%bb%81%20c%c3%a1ch%20ch%c3%bang%20ta%20x%e1%bb%ad%20l%c3%bd%20v%e1%ba%a5n%20%c4%91%e1%bb%81%20giao%20ti%e1%ba%bfp%20gi%e1%bb%afa%20c%c3%a1c%20microservices%2c%20b%c3%a2y%20gi%e1%bb%9d%20th%c3%ac%20h%c3%a3y%20b%e1%ba%aft%20%c4%91%e1%ba%a7u%20vi%e1%ba%bft%20m%e1%bb%99t%20v%c3%a0i%20d%c3%b2ng%20code%20n%c3%a0o%20%f0%9f%98%84.%0aGi%e1%bb%9d%20ta%20s%e1%ba%bd%20xem%20qua%20mock-up%20c%e1%bb%a7a%20app%20m%c3%a0%20ch%c3%bang%20ta%20s%e1%ba%bd%20build%20%c4%91%e1%bb%83%20c%c3%b3%20hi%e1%bb%83u%20h%c6%a1n%20v%e1%bb%81%20async%20communication.%20D%c6%b0%e1%bb%9bi%20%c4%91%c3%a2y%20l%c3%a0%20m%e1%bb%99t%20v%c3%a0i%20ch%c3%ba%20%c3%bd%20v%e1%bb%81%20project%20ti%e1%ba%bfp%20theo%20ch%c3%bang%20ta%20s%e1%ba%bd%20build." aria-label=Tumblr>
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&t=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#app-overview>App Overview</a></li>
<li><a href=#project-setup>Project setup</a></li>
<li><a href=#posts-service>Posts Service</a></li>
<li><a href=#comments-service>Comments Service</a></li>
<li><a href=#client>Client</a></li>
<li><a href=#event-bus-overview>Event Bus Overview</a></li>
<li><a href=#implement-query-service>Implement query service</a></li>
<li><a href=#t√≠nh-nƒÉng-m·ªõi-flag-comments>T√≠nh nƒÉng m·ªõi, flag comments</a>
<ul>
<li><a href=#y√™u-c·∫ßu>Y√™u c·∫ßu</a></li>
<li><a href=#solution>Solution</a></li>
<li><a href=#t·∫°o-moderation-service>T·∫°o Moderation Service</a></li>
<li><a href=#send-commentmoderated-event-to-commentservice>Send CommentModerated Event To CommentService</a></li>
<li><a href=#handle-commentmoderated-event>Handle CommentModerated Event</a></li>
<li><a href=#handle-commentupdated-event>Handle CommentUpdated Event</a></li>
<li><a href=#missing-event>Missing Event</a></li>
<li><a href=#missing-event-solution>Missing Event Solution</a></li>
<li><a href=#query-missing-event-for-moderation-service>Query Missing Event For Moderation Service</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
Microservices v·ªõi NodeJS ph·∫ßn 2 - m·ªôt mini-microservices app
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2021-09-10 00:00:00 +0000 UTC" itemprop=datePublished>2021-09-10</time>
</div>
<div class=article-category>
<i class="fas fa-archive"></i>
<a class=category-link href=/categories/backend>backend</a>
,
<a class=category-link href=/categories/devops>devops</a>
</div>
<div class=article-tag>
<i class="fas fa-tag"></i>
<a class=tag-link href=/tags/microservices rel=tag>microservices</a>
,
<a class=tag-link href=/tags/nodejs rel=tag>nodejs</a>
,
<a class=tag-link href=/tags/monoliths rel=tag>monoliths</a>
,
<a class=tag-link href=/tags/architecture rel=tag>architecture</a>
,
<a class=tag-link href=/tags/backend rel=tag>backend</a>
,
<a class=tag-link href=/tags/devops rel=tag>devops</a>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<p>·ªû b√†i tr∆∞·ªõc th√¨ ch√∫ng ta ƒë√£ th·∫•y m·ªôt v√†i notes v·ªÅ c√°ch ch√∫ng ta x·ª≠ l√Ω v·∫•n ƒë·ªÅ giao ti·∫øp gi·ªØa c√°c microservices, b√¢y gi·ªù th√¨ h√£y b·∫Øt ƒë·∫ßu vi·∫øt m·ªôt v√†i d√≤ng code n√†o üòÑ.</p>
<p>Gi·ªù ta s·∫Ω xem qua mock-up c·ªßa app m√† ch√∫ng ta s·∫Ω build ƒë·ªÉ c√≥ hi·ªÉu h∆°n v·ªÅ async communication. D∆∞·ªõi ƒë√¢y l√† m·ªôt v√†i ch√∫ √Ω v·ªÅ project ti·∫øp theo ch√∫ng ta s·∫Ω build.</p>
<h2 id=app-overview>App Overview</h2>
<p><img src=/images/microservices-dg-27.png alt=microservices-dg-27></p>
<ul>
<li>M·ª•c ti√™u ƒë·∫ßu ti√™n c·ªßa project l√† c√≥ c√°i nh√¨n qua v·ªÅ ki·∫øn tr√∫c microservice. Ta s·∫Ω build m·ªôt project l·ªõn h∆°n v√† to√†n di·ªán h∆°n sau, c√≤n project th√¨ ch·ªâ v·ªõi m·ª•c ƒë√≠ch l√† l√†m quen v·ªõi microservices.</li>
<li>M·ª•c ti√™u th·ª© 2 l√† build m·ªçi th·ª© t·ª´ ƒë·∫ßu nhi·ªÅu nh·∫•t c√≥ th·ªÉ ƒë·ªÉ hi·ªÉu ƒë∆∞·ª£c c√°ch ho·∫°t ƒë·ªông c·ªßa microservices.</li>
<li>‚ÑπÔ∏è <em>Kh√¥ng n√™n s·ª≠ d·ª•ng project n√†y nh∆∞ m·ªôt template nh√©.</em></li>
</ul>
<p><img src=/images/microservices-dg-28.png alt=microservices-dg-28>
Ch√∫ng ta s·∫Ω build m·ªôt web app ƒë∆°n gi·∫£n c√≥ t√≠nh nƒÉng nh∆∞ t·∫°o post, v√† comment v√†o post. Post s·∫Ω ch·ªâ c√≥ title kh√¥ng c√≥ body, ·∫£nh hay b·∫•t c·ª© th·ª© g√¨ kh√°c.</p>
<p>Khi user m·ªõi v√†o app th√¨ s·∫Ω hi·ªán 1 form ƒë·ªÉ cho user nh·∫≠p title, sau ƒë√≥ user submit th√¨ s·∫Ω hi·ªÉn th·ªã post ·ªü d∆∞·ªõi, m·ªói post s·∫Ω c√≥ 1 √¥ input ƒë·ªÉ user c√≥ th·ªÉ comment, sau khi submit th√¨ post s·∫Ω update s·ªë comment c≈©ng nh∆∞ chi ti·∫øt v·ªÅ comment ·ªü d∆∞·ªõi.</p>
<p>Nh√¨n qua th√¨ c√≥ v·∫ª r·∫•t ƒë∆°n gi·∫£n ƒë√∫ng kh√¥ng, nh∆∞ng v·ªõi microservices th√¨ c≈©ng kh√¥ng ƒë∆°n gi·∫£n cho l·∫Øm ƒë√¢u üòÑ</p>
<p>ƒê·∫ßu ti√™n th√¨ ch√∫ng ta ph·∫£i nghƒ© l√† c·∫ßn nh·ªØng service n√†o cho app n√†y.
<img src=/images/microservices-dg-29.png alt=microservices-dg-28>
V·ªõi app n√†y th√¨ ta c·∫ßn qu·∫£n l√Ω 2 resource ƒë√≥ l√† post v√† comment, trong m·ªôt d·ª± √°n th·ª±c t·∫ø th√¨ kh√¥ng h·∫≥n c·ª© ph·∫£i t·∫°o m·ªói service ri√™ng cho t·ª´ng resource nh∆∞ng ƒë·ªëi v·ªõi project n√†y th√¨ ta s·∫Ω l√†m nh∆∞ v·∫≠y ƒë·ªÉ hi·ªÉu ƒë∆∞·ª£c c√°ch giao ti·∫øp gi·ªØa 2 services.
<img src=/images/microservices-dg-30.png alt=microservices-dg-30>
Ta s·∫Ω t·∫°o 2 services l√† postservice c√≥ ch·ª©c nƒÉng l√† t·∫°o post l√† list t·∫•t c·∫£ c√°c post, commentservice c√≥ ch·ª©c nƒÉng l√† t·∫°o comment v√† list t·∫•t c·∫£ comment c·ªßa post. Nh√¨n qua th√¨ th·∫•y postservice c√≥ v·∫ª ƒë∆°n gi·∫£n, n√≥ ch·ªâ c·∫ßn 1 database l∆∞u t·∫•t c·∫£ c√°c post th·∫ø l√† ·ªïn, c√≤n commentservice th√¨ c√≥ ph·ª©c t·∫°p h∆°n 1 x√≠u, l√∫c t·∫°o 1 comment th√¨ ta s·∫Ω g·∫Øn comment ƒë√≥ v·ªõi 1 post, v√¨ v·∫≠y c√≥ depend v·ªõi postservice n√™n ch√∫ng ta s·∫Ω ph·∫£i s·ª≠ d·ª•ng 1 trong 2 c√°ch giao ti·∫øp ƒë√≥ l√† sync ho·∫∑c async, t∆∞∆°ng t·ª± th√¨ l√∫c list comment c≈©ng th·∫ø, ta kh√¥ng th·ªÉ list to√†n b·ªô comment trong database ra c√πng l√∫c m√† ta s·∫Ω ch·ªâ tr·∫£ comments t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng post c·ª• th·ªÉ.</p>
<h2 id=project-setup>Project setup</h2>
<p>Sau m·ªôt ƒë·ªëng l√Ω thuy·∫øt th√¨ cu·ªëi c√πng c≈©ng ƒë·∫øn l√∫c ƒë∆∞·ª£c vi·∫øt code r·ªìi üòÑ</p>
<p>ƒê·∫ßu ti√™n nh√¨n l·∫°i c·∫•u tr√∫c project m√† ch√∫ng ta s·∫Ω build nh√©.
<img src=/images/microservices-dg-31.png alt=microservices-dg-31>
Ph√≠a client th√¨ ta s·∫Ω d·ª±ng 1 web app v·ªõi react, browser s·∫Ω g·ª≠i request v·ªÅ c√°c services, c√°c service n√†y ƒë∆∞·ª£c build v·ªõi expressjs, hi·ªán t·∫°i th√¨ ta s·∫Ω kh√¥ng s·ª≠ d·ª•ng database cho project, ch√∫ng ta s·∫Ω gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ v·ªÅ database sau, project n√†y ta s·∫Ω l∆∞u t·∫•t c·∫£ data trong b·ªô nh·ªõ.</p>
<p><img src=/images/microservices-dg-32.png alt=microservices-dg-32></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>yarn</span> <span style=color:#a6e22e>create</span> <span style=color:#a6e22e>react</span><span style=color:#f92672>-</span><span style=color:#a6e22e>app</span> <span style=color:#a6e22e>client</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>mkdir</span> <span style=color:#a6e22e>posts</span>
<span style=color:#a6e22e>yarn</span> <span style=color:#a6e22e>init</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>y</span>
<span style=color:#a6e22e>yarn</span> <span style=color:#a6e22e>add</span> <span style=color:#a6e22e>express</span> <span style=color:#a6e22e>cors</span> <span style=color:#a6e22e>axios</span> <span style=color:#a6e22e>nodemon</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>mkdir</span> <span style=color:#a6e22e>comments</span>
<span style=color:#a6e22e>yarn</span> <span style=color:#a6e22e>init</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>y</span>
<span style=color:#a6e22e>yarn</span> <span style=color:#a6e22e>add</span> <span style=color:#a6e22e>express</span> <span style=color:#a6e22e>cors</span> <span style=color:#a6e22e>axios</span> <span style=color:#a6e22e>nodemon</span>
</code></pre></div><h2 id=posts-service>Posts Service</h2>
<p>ƒê·∫ßu ti√™n th√¨ ta s·∫Ω implement posts service c∆° b·∫£n v·ªõi expressjs ƒë·ªÉ th·ª±c hi·ªán c√°c features c·ªßa n√≥ l√† t·∫°o post v√† list posts, t·∫°m ch∆∞a quan t√¢m t·ªõi microservices.
<img src=/images/microservices-dg-33.png alt=microservices-dg-33>
V·∫≠y v·ªõi post service th√¨ ta s·∫Ω t·∫°o 1 route l√† /posts. V·ªõi method GET th√¨ ta s·∫Ω tr·∫£ v·ªÅ t·∫•t c·∫£ c√°c post v√† v·ªõi method POST c√πng v·ªõi body ch·ª©a title th√¨ ta s·∫Ω t·∫°o 1 post m·ªõi.</p>
<p><img src=/images/microservices-dg-34.png alt=microservices-dg-34>
·ªû ƒë√¢y ta s·∫Ω s·ª≠ d·ª•ng bi·∫øn <code>posts = {}</code> ƒë·ªÉ l∆∞u t·∫•t c·∫£ c√°c posts, ƒëi·ªÉm tr·ª´ ·ªü ƒë√¢y l√† m·ªói khi reset l·∫°i service th√¨ s·∫Ω m·∫•t t·∫•t c·∫£ c√°c posts. Ngo√†i ra th√¨ ch√∫ng ta s·ª≠ d·ª•ng randomBytes ƒë·ªÉ t·∫°o unique id cho t·ª´ng post.</p>
<p><img src=/images/microservices-dg-35.png alt=microservices-dg-35>
M√¨nh s·ª≠ d·ª•ng <a href=https://insomnia.rest/>insomnia</a> ƒë·ªÉ test l·∫°i 2 api v·ª´a code. Response tr·∫£ v·ªÅ statuscode 200 v√† body nh∆∞ mong mu·ªën üòÑ</p>
<h2 id=comments-service>Comments Service</h2>
<p>Ti·∫øp theo ta s·∫Ω code comments service nh∆∞ng tr∆∞·ªõc h·∫øt ƒëi·ªÉm qua requirements.
<img src=/images/microservices-dg-36.png alt=microservices-dg-36>
Comments serrvice cos 1 route l√† /posts/:id/comments/. V·ªõi method POST th√¨ t·∫°o 1 comment t∆∞∆°ng ·ª©ng v·ªõi post id v√† v·ªõi method GET th√¨ tr·∫£ v·ªÅ t·∫•t c·∫£ comments ·ª©ng v·ªõi postid ·∫•y.
<img src=/images/microservices-dg-37.png alt=microservices-dg-37>
T∆∞∆°ng t·ª± nh∆∞ posts service th√¨ ta c√≥ comments service nh∆∞ tr√™n. Test qua n√†o
<img src=/images/microservices-dg-38.png alt=microservices-dg-38></p>
<h2 id=client>Client</h2>
<p><img src=/images/microservices-dg-39.png alt=microservices-dg-39>
Tr∆∞·ªõc khi implement client th√¨ xem l·∫°i c·∫•u tr√∫c c·ªßa ph·∫ßn n√†y nh√©. App s·∫Ω c√≥ 2 component l√† PostList v√† PostCreate. PostCreate l√† form ƒë·ªÉ user submit post v√† PostList l√† component ch·ª©a post title, CommnetList v√† form ƒë·ªÉ user create comment</p>
<p><img src=/images/microservices-dg-40.png alt=microservices-dg-40></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// PostCreate
</span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useState</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PostCreate</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>props</span>) =&gt; {
  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>title</span>, <span style=color:#a6e22e>setTitle</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#e6db74>&#34;&#34;</span>);
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>onSubmit</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>e</span>) =&gt; {
    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>();

    <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;http://localhost:4000/posts&#34;</span>, {
      <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span>,
      <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span> },
      <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({ <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>title</span> }),
    })
      .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>response</span>) =&gt; <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>())
      .<span style=color:#a6e22e>then</span>((<span style=color:#ae81ff>_</span>) =&gt; {
        <span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>setNumPost</span>(<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>numPost</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
        <span style=color:#a6e22e>setTitle</span>(<span style=color:#e6db74>&#34;&#34;</span>);
      });
  };
  <span style=color:#66d9ef>return</span> (
    <span style=color:#f92672>&lt;&gt;</span>
      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>h2</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>PostCreate</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/h2&gt;</span>
      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>form</span>
        <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/posts&#34;</span>
        <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;POST&#34;</span>
        <span style=color:#a6e22e>onSubmit</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>onSubmit</span>}
        <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>borderBottom</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;1px solid black&#34;</span> }}
      <span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>label</span> <span style=color:#a6e22e>htmlFor</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-input&#34;</span><span style=color:#f92672>&gt;</span>
          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>p</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Title</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/p&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/label&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>input</span>
          <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span>
          <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-input&#34;</span>
          <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post title&#34;</span>
          <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>title</span>}
          <span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) =&gt; <span style=color:#a6e22e>setTitle</span>(<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>value</span>)}
          <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>display</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;block&#34;</span> }}
        <span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Submit</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/button&gt;</span>
      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/form&gt;</span>
    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/&gt;</span>
  );
};

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>PostCreate</span>;
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// PostList
</span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useEffect</span>, <span style=color:#a6e22e>useState</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Post</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;../Post&#34;</span>;

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PostList</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>props</span>) =&gt; {
  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>posts</span>, <span style=color:#a6e22e>setPosts</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>([]);
  <span style=color:#a6e22e>useEffect</span>(() =&gt; {
    <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;http://localhost:4000/posts&#34;</span>, {
      <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;GET&#34;</span>,
      <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span> },
    })
      .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>data</span>) =&gt; <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>json</span>())
      .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>data</span>) =&gt; <span style=color:#a6e22e>setPosts</span>(<span style=color:#a6e22e>data</span>));
  }, [<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>numPost</span>]);

  <span style=color:#66d9ef>return</span> (
    <span style=color:#f92672>&lt;&gt;</span>
      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>display</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;flex&#34;</span> }}<span style=color:#f92672>&gt;</span>
        {Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>posts</span>).<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>key</span>) =&gt; (
          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Post</span> <span style=color:#a6e22e>key</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>key</span>} <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>key</span>].<span style=color:#a6e22e>id</span>} <span style=color:#a6e22e>title</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>key</span>].<span style=color:#a6e22e>title</span>} <span style=color:#f92672>/&gt;</span>
        ))}
      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span>
    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/&gt;</span>
  );
};
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>PostList</span>;
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// Post
</span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useState</span>, <span style=color:#a6e22e>useEffect</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Post</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>props</span>) =&gt; {
  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>comments</span>, <span style=color:#a6e22e>setComments</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>([]);
  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>comment</span>, <span style=color:#a6e22e>setComment</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#e6db74>&#34;&#34;</span>);
  <span style=color:#a6e22e>useEffect</span>(() =&gt; {
    <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`http://localhost:4001/posts/:</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/comments`</span>, {
      <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;GET&#34;</span>,
      <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span> },
    })
      .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>data</span>) =&gt; <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>json</span>())
      .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>data</span>) =&gt; {
        <span style=color:#a6e22e>setComments</span>(<span style=color:#a6e22e>data</span>);
      });
  }, []);

  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>onSubmit</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>e</span>) =&gt; {
    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>();

    <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`http://localhost:4001/posts/:</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/comments`</span>, {
      <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span>,
      <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span> },
      <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({ <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>comment</span> }),
    })
      .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>response</span>) =&gt; <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>())
      .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>data</span>) =&gt; {
        <span style=color:#a6e22e>setComments</span>(<span style=color:#a6e22e>data</span>);
      });
  };
  <span style=color:#66d9ef>return</span> (
    <span style=color:#f92672>&lt;&gt;</span>
      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span>
        <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;comment&#34;</span>
        <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>margin</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;2px&#34;</span>, <span style=color:#a6e22e>backgroundColor</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;#c4ffff&#34;</span>, <span style=color:#a6e22e>padding</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;10px&#34;</span> }}
      <span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>p</span><span style=color:#f92672>&gt;</span>{<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>title</span>}<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/p&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>span</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>fontStyle</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;italic&#34;</span> }}<span style=color:#f92672>&gt;</span>{<span style=color:#a6e22e>comments</span>.<span style=color:#a6e22e>length</span>} <span style=color:#a6e22e>comments</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/span&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>ul</span><span style=color:#f92672>&gt;</span>
          {<span style=color:#a6e22e>comments</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>c</span>) =&gt; (
            <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>li</span> <span style=color:#a6e22e>key</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>id</span>}<span style=color:#f92672>&gt;</span>{<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>content</span>}<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/li&gt;</span>
          ))}
        <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/ul&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>p</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Comment</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/p&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>form</span>
          <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span>{<span style=color:#e6db74>`http://localhost:4001/posts/:</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/comments`</span>}
          <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;POST&#34;</span>
        <span style=color:#f92672>&gt;</span>
          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>input</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>comment</span>} <span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) =&gt; <span style=color:#a6e22e>setComment</span>(<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>value</span>)} <span style=color:#f92672>/&gt;</span>
          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>onSubmit</span>}<span style=color:#f92672>&gt;</span>
            <span style=color:#a6e22e>Submit</span>
          <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/button&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/form&gt;</span>
      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span>
    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/&gt;</span>
  );
};
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Post</span>;
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// App.js
</span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useState</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react/cjs/react.development&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>PostCreate</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./components/PostCreate&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>PostList</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./components/PostList&#34;</span>;

<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>App</span>() {
  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>numPost</span>, <span style=color:#a6e22e>setNumPost</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#ae81ff>0</span>);
  <span style=color:#66d9ef>return</span> (
    <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;App&#34;</span><span style=color:#f92672>&gt;</span>
      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>PostCreate</span> <span style=color:#a6e22e>setNumPost</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>setNumPost</span>} <span style=color:#a6e22e>numPost</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>numPost</span>} <span style=color:#f92672>/&gt;</span>
      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>PostList</span> <span style=color:#a6e22e>numPost</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>numPost</span>} <span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span>
  );
}

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>App</span>;
</code></pre></div><p><img src=/images/microservices-dg-41.png alt=microservices-dg-41>
Hi·ªán t·∫°i th√¨ app c·ªßa ch√∫ng ta ƒë√£ ch·∫°y nh∆∞ mong mu·ªën, nh∆∞ng c√≥ m·ªôt v·∫•n ƒë·ªÅ l√† sau khi query posts, ch√∫ng ta c√≥ t·∫•t c·∫£ c√°c posts nh∆∞ng ƒë·ªÉ c√≥ c·∫£ comments th√¨ m·ªói post ta l·∫°i ph·∫£i query m·ªôt l·∫ßn n·ªØa ƒë·ªÉ l·∫•y t·∫•t c·∫£ comment. ƒêi·ªÅu n√†y th·ª±c s·ª± kh√¥ng hi·ªáu qu·∫£ ch√∫t n√†o.</p>
<p>V·∫≠y l√†m sao ta c√≥ th·ªÉ ch·ªâ v·ªõi 1 request m√† query ƒë∆∞·ª£c to√†n b·ªô posts c≈©ng nh∆∞ comments ? Ta c√≥ th·ªÉ b·ªï sung th√™m trong posts service v·ªõi get posts api ta s·∫Ω requests ƒë·∫øn commentservice ƒë·ªÉ l·∫•y data v·ªÅ comment v√† tr·∫£ v·ªÅ comments theo posts lu√¥n. Nh∆∞ng nh∆∞ v·∫≠y th√¨ s·ªë request ƒë∆∞·ª£c g·ªçi v·∫´n kh√¥ng ƒë·ªïi, ta ch·ªâ ƒë·ªïi t·ª´ g·ªçi ·ªü client sang g·ªçi ·ªü server, h∆°n n·ªØa vi·ªác request t·ª´ postservice t·ªõi commentservice s·∫Ω t·∫°o dependency gi·ªØa c√°c services - l√† v·∫•n ƒë·ªÅ c·ªßa sync communication. V√† ƒë√¢y c≈©ng ch√≠nh l√† l√∫c ta s·∫Ω s·ª≠ d·ª•ng async communication ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y.
<img src=/images/microservices-dg-42.png alt=microservices-dg-42></p>
<p>Tr∆∞·ªõc khi ƒëi v√†o implement query service c≈©ng nh∆∞ code l·∫°i c√°c service kh√°c ƒë·ªÉ ch√∫ng s·ª≠ d·ª•ng event bus th√¨ c√≥ th·ªÉ b·∫°n s·∫Ω c√≥ m·ªôt v√†i th·∫Øc m·∫Øc sau ƒë√¢y:
<img src=/images/microservices-dg-43.png alt=microservices-dg-43></p>
<ol>
<li>Ch√∫ng ta c√≥ th·ª±c s·ª± c·∫ßn t·∫°o th√™m service m·ªõi m·ªói khi c·∫ßn join data hay kh√¥ng ?</li>
</ol>
<ul>
<li>Kh√¥ng. Tr√™n th·ª±c t·∫ø th√¨ c√≥ th·ªÉ posts v√† comments c√≥ th·ªÉ c√πng chung 1 service.</li>
</ul>
<ol start=2>
<li>Sao l·∫°i c·∫ßn quan t√¢m vi·ªác c√°c service ƒë·ªôc l·∫≠p v·ªõi nhau, c·∫ßn g√¨ ph·∫£i d√πng async communication l√†m qu√°i g√¨ cho l·∫±ng nh·∫±ng ?</li>
</ol>
<ul>
<li>M·ªôt trong nh·ªØng l√Ω do ch√≠nh ƒë·ªÉ s·ª≠ d·ª•ng microservices l√† t√≠nh ƒë·ªôc l·∫≠p gi·ªØa c√°c services gi√∫p ·ª©ng d·ª•ng c·ªßa b·∫°n kh√¥ng d·ªÖ d√†ng crash ho√†n nh∆∞ monolith.</li>
</ul>
<ol start=3>
<li>S·ª≠ d·ª•ng c·∫•u tr√∫c ph·ª©c t·∫°p nh∆∞ v·∫≠y ch·ªâ ƒë·ªÉ c√≥ ch√∫t l·ª£i √≠ch nh∆∞ v·∫≠y ?</li>
</ol>
<ul>
<li>V·ªõi app hi·ªán t·∫°i th√¨ c√≥ v·∫ª nh∆∞ v·∫≠y, nh∆∞ng khi app b·∫Øt ƒë·∫ßu l·ªõn l√™n d·∫ßn th√¨ s·ª≠ d·ª•ng ki·∫øn tr√∫c nh∆∞ n√†y s·∫Ω gi√∫p b·∫°n th·∫•y d·ªÖ d√†ng h∆°n trong qu√° tr√¨nh develope k·ªÉ c·∫£ so v·ªõi monolith.</li>
</ul>
<ol start=4>
<li>H·ªá th·ªëng thi·∫øt k·∫ø theo d·∫°ng event bus c√≥ th·ªÉ s·∫Ω kh√¥ng ho·∫°t ƒë·ªông ch√≠nh x√°c trong tr∆∞·ªùng h·ª£p nh∆∞ n√†y,&mldr; nh∆∞ kia,&mldr;</li>
</ol>
<ul>
<li>Nh∆∞ ƒë·∫ßu b√†i m√¨nh c√≥ n√≥i th√¨ kh√¥ng n√™n s·ª≠ d·ª•ng app n√†y nh∆∞ 1 template v√¨ app n√†y m·ª•c ƒë√≠ch ch·ªâ gi√∫p b·∫°n c√≥ c√°i nh√¨n t·ªïng quan v·ªÅ microservices, project ti·∫øp theo ch√∫ng ta s·∫Ω ƒëi s√¢u v√†o t·ª´ng chi ti·∫øt h∆°n c≈©ng nh∆∞ implement l·∫°i code m·ªôt c√°ch chuy√™n nghi·ªáp h∆°n v√† c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë·ªÉ l√†m production ƒë∆∞·ª£c.</li>
</ul>
<h2 id=event-bus-overview>Event Bus Overview</h2>
<p><img src=/images/microservices-dg-44.png alt=microservices-dg-44></p>
<ul>
<li>C√≥ nhi·ªÅu c√°ch tri·ªÉn khai Event Bus kh√°c nhau: RabbitMQ, Kafka, NATS,&mldr; b·∫°n c√≥ th·ªÉ download v√† t·ª± host ƒë·ªÉ s·ª≠ d·ª•ng ho·∫∑c c√≥ th·ªÉ s·ªß d·ª•ng qua c√°c d·ªãch v·ª• cung c·∫•p s·∫µn.</li>
<li>Event Bus d√πng ƒë·ªÉ nh·∫≠n events v√† publishes events t·ªõi listeners. Events ·ªü ƒë√¢y l√† m·ªôt d·∫°ng th√¥ng tin c√≥ th·ªÉ l√† JSON, c√≥ th·ªÉ l√† raw bytes c≈©ng c√≥ th·ªÉ l√† string, n√≥ c√≥ th·ªÉ l√† b·∫•t c·ª© th·ª© g√¨ b·∫°n mu·ªën share v·ªõi c√°c services kh√°c.</li>
<li>C√≥ nhi·ªÅu t√≠nh nƒÉng khi·∫øn vi·ªác async communication d·ªÖ h∆°n nhi·ªÅu ho·∫∑c kh√≥ h∆°n. Ch√∫ng ta s·∫Ω t√¨m hi·ªÉu th√™m ·ªü project ti·∫øp theo.</li>
<li>Ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng Expresjs ƒë·ªÉ build event bus, nh∆∞ ƒë√£ n√≥i th√¨ project n√†y ch·ªâ gi√∫p b·∫°n hi·ªÉu ƒë∆∞·ª£c c∆° ch·∫ø ho·∫°t ƒë·ªông c·ªßa microservices n√™n event bus n√†y c≈©ng v·∫≠y, n√≥ thi·∫øu r·∫•t nhi·ªÅu t√≠nh nƒÉng m√† m·ªôt bus c√≥.</li>
<li>Project ti·∫øp theo ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng event bus ƒë∆∞·ª£c s·ª≠ d·ª•ng trong c√°c project th·ª±c t·∫ø.</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// events bus
</span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>axios</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;axios&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>cors</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;cors&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>bodyParser</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;body-parser&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>express</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;express&#34;</span>;

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>();
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>cors</span>());
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>bodyParser</span>.<span style=color:#a6e22e>json</span>());
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/events&#34;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;http://localhost:4002/events&#34;</span>, <span style=color:#a6e22e>event</span>).<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) =&gt; {
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>);
  });

  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>({ <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;OK&#34;</span> });
});

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>4005</span>, () =&gt; {
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Listening on port 4005&#34;</span>);
});
</code></pre></div><p>·ªû ƒë√¢y ch·ªâ c√≥ query service c·∫ßn l·∫Øng nghe t·ªõi event PostCreated v√† CommentCreated.</p>
<h2 id=implement-query-service>Implement query service</h2>
<p>Emit event t·ª´ post service</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// post service
</span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/posts&#34;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>randomBytes</span>(<span style=color:#ae81ff>4</span>).<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#34;hex&#34;</span>);
  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>title</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;

  <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>id</span>] <span style=color:#f92672>=</span> {
    <span style=color:#a6e22e>id</span>,
    <span style=color:#a6e22e>title</span>,
  };

  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>
    .<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;http://localhost:4005/events&#34;</span>, {
      <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;PostCreated&#34;</span>,
      <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>id</span>,
        <span style=color:#a6e22e>title</span>,
      },
    })
    .<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) =&gt; {
      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>);
    });

  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>200</span>).<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>id</span>]);
});
</code></pre></div><p>Emit event t·ª´ comment service</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// comment service
</span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/posts/:id/comments&#34;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>randomBytes</span>(<span style=color:#ae81ff>4</span>).<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#34;hex&#34;</span>);
  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>content</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>postId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>id</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>1</span>);

  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>postComments</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>comments</span>[<span style=color:#a6e22e>postId</span>] <span style=color:#f92672>||</span> [];
  <span style=color:#a6e22e>postComments</span>.<span style=color:#a6e22e>push</span>({ <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>content</span> });

  <span style=color:#a6e22e>comments</span>[<span style=color:#a6e22e>postId</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>postComments</span>;

  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>
    .<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;http://localhost:4005/events&#34;</span>, {
      <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;CommentCreated&#34;</span>,
      <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>postId</span>,
        <span style=color:#a6e22e>id</span>,
        <span style=color:#a6e22e>content</span>,
      },
    })
    .<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) =&gt; {
      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>);
    });

  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>200</span>).<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>postComments</span>);
});
</code></pre></div><p>L·∫Øng nghe event t·ª´ query service</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// query service
</span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>cors</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;cors&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>express</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;express&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>bodyParser</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;body-parser&#34;</span>;

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> {};

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>();
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>bodyParser</span>.<span style=color:#a6e22e>json</span>());
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>cors</span>());

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/posts&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>posts</span>);
});

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/events&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;

  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>type</span>) {
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;PostCreated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>id</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>;
      <span style=color:#66d9ef>break</span>;
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;CommentCreated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>comments</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>postId</span>].<span style=color:#a6e22e>comments</span> <span style=color:#f92672>||</span> [];
      <span style=color:#a6e22e>comments</span>.<span style=color:#a6e22e>push</span>({ <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span> });
      <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>postId</span>].<span style=color:#a6e22e>comments</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>comments</span>;
    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>break</span>;
  }
  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>({ <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;OK&#34;</span> });
});

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>4002</span>, () =&gt; {
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Listening on port 4002&#34;</span>);
});
</code></pre></div><p>B√¢y gi·ªù th√¨ ta c√≥ th·ªÉ update api endpoint cho client ƒë∆∞·ª£c r·ªìi üòÑ</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// PostList
</span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useEffect</span>, <span style=color:#a6e22e>useState</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Post</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;../Post&#34;</span>;

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PostList</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>props</span>) =&gt; {
  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>posts</span>, <span style=color:#a6e22e>setPosts</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>([]);
  <span style=color:#a6e22e>useEffect</span>(() =&gt; {
    <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;http://localhost:4002/posts&#34;</span>, {
      <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;GET&#34;</span>,
      <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span> },
    })
      .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>data</span>) =&gt; <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>json</span>())
      .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>data</span>) =&gt; <span style=color:#a6e22e>setPosts</span>(<span style=color:#a6e22e>data</span>));
  }, [<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>numPost</span>]);

  <span style=color:#66d9ef>return</span> (
    <span style=color:#f92672>&lt;&gt;</span>
      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>display</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;flex&#34;</span> }}<span style=color:#f92672>&gt;</span>
        {Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>posts</span>).<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>key</span>) =&gt; (
          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Post</span>
            <span style=color:#a6e22e>key</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>key</span>}
            <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>key</span>].<span style=color:#a6e22e>id</span>}
            <span style=color:#a6e22e>title</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>key</span>].<span style=color:#a6e22e>title</span>}
            <span style=color:#a6e22e>comments</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>key</span>].<span style=color:#a6e22e>comments</span>}
          <span style=color:#f92672>/&gt;</span>
        ))}
      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span>
    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/&gt;</span>
  );
};
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>PostList</span>;
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// Post
</span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useState</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Post</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>props</span>) =&gt; {
  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>comments</span>, <span style=color:#a6e22e>setComments</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>comments</span> <span style=color:#f92672>||</span> []);
  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>comment</span>, <span style=color:#a6e22e>setComment</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#e6db74>&#34;&#34;</span>);
  <span style=color:#75715e>// useEffect(() =&gt; {
</span><span style=color:#75715e></span>  <span style=color:#75715e>//   fetch(`http://localhost:4001/posts/:${props.id}/comments`, {
</span><span style=color:#75715e></span>  <span style=color:#75715e>//     method: &#34;GET&#34;,
</span><span style=color:#75715e></span>  <span style=color:#75715e>//     headers: { &#34;Content-Type&#34;: &#34;application/json&#34; },
</span><span style=color:#75715e></span>  <span style=color:#75715e>//   })
</span><span style=color:#75715e></span>  <span style=color:#75715e>//     .then((data) =&gt; data.json())
</span><span style=color:#75715e></span>  <span style=color:#75715e>//     .then((data) =&gt; {
</span><span style=color:#75715e></span>  <span style=color:#75715e>//       setComments(data);
</span><span style=color:#75715e></span>  <span style=color:#75715e>//     });
</span><span style=color:#75715e></span>  <span style=color:#75715e>// }, []);
</span><span style=color:#75715e></span>  ....
};
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Post</span>;
</code></pre></div><h2 id=t√≠nh-nƒÉng-m·ªõi-flag-comments>T√≠nh nƒÉng m·ªõi, flag comments</h2>
<p><img src=/images/microservices-dg-45.png alt=microservices-dg-45></p>
<p>Y√™u c·∫ßu v·ªÅ t√≠nh nƒÉng m·ªõi: ƒë√°nh d·∫•u 1 comment n·∫øu n√≥ ch·ª©a t·ª´ &lsquo;orange&rsquo;</p>
<p><img src=/images/microservices-dg-46.png alt=microservices-dg-46></p>
<ul>
<li>Th·ª±c t·∫ø th√¨ t√≠nh nƒÉng n√†y c·ª±c k·ª≥ d·ªÖ l√†m tr√™n react, ch·ªâ c·∫ßn hard code check l√† xong, tuy nhi√™n n·∫øu t·ª´ kh√≥a n√†y thay ƒë·ªïi nhi·ªÅu l·∫ßn th√¨ s·∫Ω kh√¥ng ph√π h·ª£p n·∫øu ta deploy l·∫°i react app li√™n t·ª•c.</li>
<li>T√≠nh nƒÉng n√†y c≈©ng d·ªÖ n·∫øu implement lu√¥n tr√™n comments service hi·ªán t·∫°i tuy nhi√™n v√¨ m·ª•c ƒë√≠ch n√™u l√™n ƒë∆∞·ª£c v·∫•n ƒë·ªÅ v·ªÅ event bus n√™n ta s·∫Ω s·ª≠ d·ª•ng 1 service m·ªõi.</li>
<li>C≈©ng t∆∞∆°ng t·ª± nh∆∞ tr√™n th√¨ ta s·∫Ω gi·∫£ s·ª≠ service m·ªõi n√†y m·∫•t nhi·ªÅu th·ªùi gian ƒë·ªÉ ƒë√°nh gi√° c≈©ng nh∆∞ ch·ªânh s·ª≠a comment.</li>
</ul>
<p><img src=/images/microservices-dg-47.png alt=microservices-dg-47></p>
<h3 id=y√™u-c·∫ßu>Y√™u c·∫ßu</h3>
<p>Y√™u c·∫ßu c·ªßa t√≠nh nƒÉng n√†y l√† sau khi comment, n·∫øu service m·ªõi - <code>moderate service</code> ch∆∞a x·ª≠ l√Ω xong comment th√¨ user ph·∫£i nh·∫≠n ƒë∆∞·ª£c tr·∫°ng th√°i c·ªßa comment l√† <code>awaiting</code> ch·ª© kh√¥ng ph·∫£i kh√¥ng th·∫•y comment, sau khi x·ª≠ l√Ω xong th√¨ n·∫øu ƒë∆∞·ª£c approve comment s·∫Ω hi·ªÉn th·ªã b√¨nh th∆∞·ªùng c√≤n kh√¥ng s·∫Ω hi·ªÉn th·ªã b·ªã rejected.</p>
<p><img src=/images/microservices-dg-48.png alt=microservices-dg-48>
ƒê·ªÉ user bi·∫øt ƒë∆∞·ª£c tr·∫°ng th√°i c·ªßa comment th√¨ react app ph·∫£i bi·∫øt ƒë∆∞·ª£c s·ª± kh√°c nhau gi·ªØa c√°c tr·∫°ng th√°i.</p>
<p><img src=/images/microservices-dg-49.png alt=microservices-dg-49></p>
<h3 id=solution>Solution</h3>
<p>C√°ch ti·∫øp c·∫≠n ƒë·∫ßu ti√™n m√† ta nghƒ© ƒë·∫øn l√†: Sau khi user summit comment, comment service s·∫Ω t·∫°o 1 event, event n√†y s·∫Ω ƒë∆∞·ª£c l·∫Øng nghe b·ªüi moderation service, moderation service s·∫Ω ƒë√°nh gi√° comment v√† update tr·∫°ng th√°i c·ªßa comment sau ƒë√≥ t·∫°o 1 event m·ªõi, query service l·∫Øng nghe event n√†y v√† update l·∫°i comment trong db c·ªßa m√¨nh.</p>
<p>Nh∆∞ ƒë√£ gi·∫£ s·ª≠ ·ªü tr√™n th√¨ moderation service n√†y c√≥ th·ªÉ m·∫•t nhi·ªÅu th·ªùi gian ƒë·ªÉ x·ª≠ l√Ω comment m·ªõi ƒë∆∞·ª£c t·∫°o, v√≠ d·ª• nh∆∞ c·∫ßn x·ª≠ l√Ω ng√¥n ng·ªØ t·ª± nhi√™n ch·∫≥ng h·∫°n ho·∫∑c c·∫ßn li√™n quan ƒë·∫øn h·ªá th·ªëng recommendation, n·∫øu s·ª≠ d·ª•ng c√°ch ti·∫øp c·∫≠n tr√™n th√¨ user s·∫Ω ph·∫£i ch·ªù 1 l√∫c ƒë·ªÉ moderation handle xong m·ªõi th·∫•y comment c·ªßa m√¨nh ƒë∆∞·ª£c hi·ªÉn th·ªã.
<img src=/images/microservices-dg-50.png alt=microservices-dg-50></p>
<p>ƒê·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ c·ªßa c√°ch ti·∫øp c·∫≠n ƒë·∫ßu ti√™n th√¨ ta c√≥ th·ªÉ nghƒ© ƒë·∫øn ngay l√† ngay khi c√≥ event CommentCreated t·ª´ commentservice th√¨ ƒë·ªìng th·ªùi queryservice c≈©ng l·∫Øng nghe event n√†y v√† update v√†o db v·ªõi status l√† pending, sau khi moderation ki·ªÉm tra comment xong th√¨ s·∫Ω emit event v·ªõi type l√† CommentModerated, queryservice l·∫°i nh·∫≠n ƒë∆∞·ª£c event n√†y v√† update status m·ªõi cho queryservice.</p>
<p><img src=/images/microservices-dg-51.png alt=microservices-dg-51>
Ch√∫ng ta ƒë√£ gi·∫£i quy·∫øt ƒë∆∞·ª£c v·∫•n ƒë·ªÅ user s·∫Ω kh√¥ng th·∫•y g√¨ x·∫£y ra sau khi comment b·∫±ng c√°ch tr√™n v√¨ ph·∫£i ch·ªù moderation x·ª≠ l√Ω b·∫±ng c√°ch tr√™n nh∆∞ng li·ªáu n√≥ c√≥ ·ªïn v·ªõi 1 app l·ªõn v·ªõi 1 h·ªá th·ªëng comment ph·ª©c t·∫°p ?</p>
<p>QueryService ƒë∆∞·ª£c t·∫°o ra v·ªõi m·ª•c ƒë√≠ch l√† l·∫•y d·ªØ li·ªáu, n√≥ kh√¥ng n√™n quan t√¢m t·ªõi b·∫•t c·ª© th·ª© g√¨ kh√°c nh∆∞ buniness,&mldr; N·∫øu ch·ªâ v·ªõi 1 type l√† Moderated th√¨ s·∫Ω ·ªïn nh∆∞ng v·ªõi nhi·ªÅu type nh∆∞ v·∫≠y v√† nhi·ªÅu x·ª≠ l√Ω kh√°c nhau nh∆∞ v·∫≠y th√¨ ta n√™n ch√∫ng ·ªü m·ªôt service kh√°c chuy√™n bi·ªát v·ªÅ comment h∆°n nh∆∞ CommentService.
<img src=/images/microservices-dg-52.png alt=microservices-dg-52></p>
<h3 id=t·∫°o-moderation-service>T·∫°o Moderation Service</h3>
<p>ƒê·∫ßu ti√™n t·∫°o moderation service l·∫Øng nghe CommentCreated event.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// moderation service
</span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>cors</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;cors&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>express</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;express&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>bodyParser</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;body-parser&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>axios</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;axios&#34;</span>;

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>();
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>bodyParser</span>.<span style=color:#a6e22e>json</span>());
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>cors</span>());

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/events&#34;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;

  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>type</span>) {
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;CommentCreated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#34;orange&#34;</span>)
        <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;rejected&#34;</span>
        <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;approved&#34;</span>;
      <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>
        .<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;http://localhost:4005/events&#34;</span>, {
          <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;CommentModerated&#34;</span>,
          <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>,
        })
        .<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) =&gt; {
          <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>);
        });
    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>break</span>;
  }
  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>({ <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;OK&#34;</span> });
});

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>4003</span>, () =&gt; {
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Listening on port 4003&#34;</span>);
});
</code></pre></div><h3 id=send-commentmoderated-event-to-commentservice>Send CommentModerated Event To CommentService</h3>
<p>EventBus s·∫Ω g·ª≠i event ƒë·∫øn comment service khi comment ƒë∆∞·ª£c moderated.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// event service
</span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/events&#34;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;
  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>type</span>) {
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;CommentCreated&#34;</span><span style=color:#f92672>:</span>
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;PostCreated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>await</span> Promise.<span style=color:#a6e22e>all</span>([
        <span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;http://localhost:4002/events&#34;</span>, <span style=color:#a6e22e>event</span>),
        <span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;http://localhost:4003/events&#34;</span>, <span style=color:#a6e22e>event</span>),
      ]).<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) =&gt; {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>);
      });
      <span style=color:#66d9ef>break</span>;
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;CommentModerated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;http://localhost:4001/events&#34;</span>, <span style=color:#a6e22e>event</span>).<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) =&gt; {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>);
      });
      <span style=color:#66d9ef>break</span>;
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;CommentUpdated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;http://localhost:4002/events&#34;</span>, <span style=color:#a6e22e>event</span>).<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) =&gt; {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>);
      });
      <span style=color:#66d9ef>break</span>;
    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>break</span>;
  }

  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>({ <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;OK&#34;</span> });
});
</code></pre></div><h3 id=handle-commentmoderated-event>Handle CommentModerated Event</h3>
<p>CommentService nh·∫≠n th·∫•y comment ƒë∆∞·ª£c moderated v√† update l·∫°i db ƒë·ªìng th·ªùi emit 1 event b√°o cho query service r·∫±ng comment v·ª´a ƒë∆∞·ª£c update</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// comment service
</span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/events&#34;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;

  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>type</span>) {
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;CommentModerated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>comment</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>comments</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>postId</span>].<span style=color:#a6e22e>find</span>(
        (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>id</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>id</span>
      );
      <span style=color:#a6e22e>comment</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>status</span>;
      <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>
        .<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;http://localhost:4005/events&#34;</span>, {
          <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;CommentUpdated&#34;</span>,
          <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>,
        })
        .<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) =&gt; {
          <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>);
        });
    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>break</span>;
  }
  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>({ <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;OK&#34;</span> });
});
</code></pre></div><h3 id=handle-commentupdated-event>Handle CommentUpdated Event</h3>
<p>QueryService nh·∫≠n ƒë∆∞·ª£c event r·∫±ng comment ƒë∆∞·ª£c update n√™n update l·∫°i comment,</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// query service
</span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/events&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;

  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>type</span>) {
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;PostCreated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>id</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>;
      <span style=color:#66d9ef>break</span>;
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;CommentCreated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>comments</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>postId</span>].<span style=color:#a6e22e>comments</span> <span style=color:#f92672>||</span> [];
      <span style=color:#a6e22e>comments</span>.<span style=color:#a6e22e>push</span>({
        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>id</span>,
        <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>,
        <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>status</span>,
      });
      <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>postId</span>].<span style=color:#a6e22e>comments</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>comments</span>;
      <span style=color:#66d9ef>break</span>;
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;CommentUpdated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>comment</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>postId</span>].<span style=color:#a6e22e>comments</span>.<span style=color:#a6e22e>find</span>(
        (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>id</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>id</span>
      );
      <span style=color:#a6e22e>comment</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>status</span>;
    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>break</span>;
  }
  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>({ <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;OK&#34;</span> });
});
</code></pre></div><h3 id=missing-event>Missing Event</h3>
<p><img src=/images/microservices-dg-53.png alt=microservices-dg-53>
V·∫≠y l√† m·ªçi th·ª© c√≥ v·∫ª ƒë√£ ho√†n h·∫£o, comment c·ªßa user s·∫Ω ƒë∆∞·ª£c x·ª≠ l√Ω ngay l·∫≠p t·ª©c v√† ƒë∆∞·ª£c update l·∫°i sau khi moderation service x·ª≠ l√Ω xong.</p>
<p><img src=/images/microservices-dg-54.png alt=microservices-dg-54></p>
<p>Tuy nhi√™n nh√¨n k·∫øt qu·∫£ ph√≠a tr√™n, comment th·ª© 3 ta th·∫•y l√∫c moderation service b·ªã crash th√¨ s·∫Ω x·∫£y ra hi·ªán t∆∞·ª£ng missing event, moderation service ƒë√£ miss 1 event CommentCreated d·∫´n t·ªõi kh√¥ng check ƒë∆∞·ª£c comment content ƒë·ªìng th·ªùi update l·∫°i status c·ªßa comment.</p>
<p><img src=/images/microservices-dg-55.png alt=microservices-dg-55>
B·∫•t k·ª≥ service n√†o b·ªã crash c≈©ng s·∫Ω g√¢y ·∫£nh h∆∞·ªüng to√†n b·ªô ƒë·∫øn app. V·∫≠y c√≥ c√°ch gi·∫£i quy·∫øt n√†o kh√¥ng.</p>
<h3 id=missing-event-solution>Missing Event Solution</h3>
<p><img src=/images/microservices-dg-56.png alt=microservices-dg-56></p>
<p>C√≥ th·ªÉ b·∫°n kh√¥ng tin nh∆∞ng ƒë√∫ng r·ªìi ƒë·∫•y, tr√™n th·ª±c t·∫ø th√¨ ng∆∞·ªùi ta s·∫Ω l∆∞u tr·ªØ c√°c event l·∫°i ƒë·ªÉ tr√°nh tr∆∞·ªùng h·ª£p b·ªã missing event. Service b·ªã crash sau khi start l·∫°i s·∫Ω query ƒë·ªÉ t√¨m nh·ªØng event c·∫ßn ƒë∆∞·ª£c th·ª±c thi v√† th·ª±c thi ch√∫ng.</p>
<p>Ta s·∫Ω l∆∞u l·∫°i event</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// event service
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>events</span> <span style=color:#f92672>=</span> [];
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/events&#34;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;
  <span style=color:#a6e22e>events</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>event</span>);
...
</code></pre></div><p>Query event</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// event service
</span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/events&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>events</span>);
});
</code></pre></div><p>Query events m·ªói khi start</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// query service
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handleEvent</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>event</span>) =&gt; {
  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>type</span>) {
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;PostCreated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>id</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>;
      <span style=color:#66d9ef>break</span>;
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;CommentCreated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>comments</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>postId</span>].<span style=color:#a6e22e>comments</span> <span style=color:#f92672>||</span> [];
      <span style=color:#a6e22e>comments</span>.<span style=color:#a6e22e>push</span>({
        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>id</span>,
        <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>,
        <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>status</span>,
      });
      <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>postId</span>].<span style=color:#a6e22e>comments</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>comments</span>;
      <span style=color:#66d9ef>break</span>;
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;CommentUpdated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>comment</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>posts</span>[<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>postId</span>].<span style=color:#a6e22e>comments</span>.<span style=color:#a6e22e>find</span>(
        (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>id</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>id</span>
      );
      <span style=color:#a6e22e>comment</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>status</span>;
    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>break</span>;
  }
};

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/events&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;
  <span style=color:#a6e22e>handleEvent</span>(<span style=color:#a6e22e>event</span>);

  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>({ <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;OK&#34;</span> });
});

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>4002</span>, <span style=color:#66d9ef>async</span> () =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>res</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;http://localhost:4005/events&#34;</span>);

  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>event</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>data</span>) {
    <span style=color:#a6e22e>handleEvent</span>(<span style=color:#a6e22e>event</span>);
  }
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Listening on port 4002&#34;</span>);
});
</code></pre></div><p>V·∫≠y l√† ta ƒë√£ x·ª≠ l√Ω xong tr∆∞·ªùng h·ª£p missing event cho query service, th·ª≠ √°p d·ª•ng v√†o moderation service nh√©.</p>
<h3 id=query-missing-event-for-moderation-service>Query Missing Event For Moderation Service</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// moderation service
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handleEvent</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>event</span>) =&gt; {
  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>type</span>) {
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;CommentCreated&#34;</span><span style=color:#f92672>:</span>
      <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#34;orange&#34;</span>)
        <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;rejected&#34;</span>
        <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;approved&#34;</span>;
      <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>
        .<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;http://localhost:4005/events&#34;</span>, {
          <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;CommentModerated&#34;</span>,
          <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>,
        })
        .<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) =&gt; {
          <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>);
        });
    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>break</span>;
  }
};

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/events&#34;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>handleEvent</span>(<span style=color:#a6e22e>event</span>);
  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>({ <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;OK&#34;</span> });
});

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>4003</span>, <span style=color:#66d9ef>async</span> () =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>res</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;http://localhost:4005/events&#34;</span>);

  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>event</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>data</span>) {
    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>handleEvent</span>(<span style=color:#a6e22e>event</span>);
  }
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Listening on port 4003&#34;</span>);
});
</code></pre></div><p>V·∫≠y l√† ch√∫ng ta ƒë√£ ho√†n th√†nh ƒë∆∞·ª£c 1 mini microservice app, n·∫Øm ƒë∆∞·ª£c c√°c kh√°i ni·ªám c∆° b·∫£n v·ªÅ microservice. B√†i ti·∫øp theo ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng docker ƒë·ªÉ deploy ch·∫°y c√°c services tr√™n. C√°c b·∫°n nh·ªõ ƒë√≥n xem nh√© üòÑ</p>
</div>
</article>
<div class=blog-post-comments>
<div id=disqus_thread>
<script type=text/javascript>(function(){var a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,b='ducnguyen96',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</div>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li><a href=#app-overview>App Overview</a></li>
<li><a href=#project-setup>Project setup</a></li>
<li><a href=#posts-service>Posts Service</a></li>
<li><a href=#comments-service>Comments Service</a></li>
<li><a href=#client>Client</a></li>
<li><a href=#event-bus-overview>Event Bus Overview</a></li>
<li><a href=#implement-query-service>Implement query service</a></li>
<li><a href=#t√≠nh-nƒÉng-m·ªõi-flag-comments>T√≠nh nƒÉng m·ªõi, flag comments</a>
<ul>
<li><a href=#y√™u-c·∫ßu>Y√™u c·∫ßu</a></li>
<li><a href=#solution>Solution</a></li>
<li><a href=#t·∫°o-moderation-service>T·∫°o Moderation Service</a></li>
<li><a href=#send-commentmoderated-event-to-commentservice>Send CommentModerated Event To CommentService</a></li>
<li><a href=#handle-commentmoderated-event>Handle CommentModerated Event</a></li>
<li><a href=#handle-commentupdated-event>Handle CommentUpdated Event</a></li>
<li><a href=#missing-event>Missing Event</a></li>
<li><a href=#missing-event-solution>Missing Event Solution</a></li>
<li><a href=#query-missing-event-for-moderation-service>Query Missing Event For Moderation Service</a></li>
</ul>
</li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f" aria-label=Facebook>
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&text=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&is_video=false&description=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label=Pinterest>
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app&body=Check out this article: %2fposts%2fbackend%2fmicroservices-with-node-p2%2f" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&name=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app&description=%e1%bb%9e%20b%c3%a0i%20tr%c6%b0%e1%bb%9bc%20th%c3%ac%20ch%c3%bang%20ta%20%c4%91%c3%a3%20th%e1%ba%a5y%20m%e1%bb%99t%20v%c3%a0i%20notes%20v%e1%bb%81%20c%c3%a1ch%20ch%c3%bang%20ta%20x%e1%bb%ad%20l%c3%bd%20v%e1%ba%a5n%20%c4%91%e1%bb%81%20giao%20ti%e1%ba%bfp%20gi%e1%bb%afa%20c%c3%a1c%20microservices%2c%20b%c3%a2y%20gi%e1%bb%9d%20th%c3%ac%20h%c3%a3y%20b%e1%ba%aft%20%c4%91%e1%ba%a7u%20vi%e1%ba%bft%20m%e1%bb%99t%20v%c3%a0i%20d%c3%b2ng%20code%20n%c3%a0o%20%f0%9f%98%84.%0aGi%e1%bb%9d%20ta%20s%e1%ba%bd%20xem%20qua%20mock-up%20c%e1%bb%a7a%20app%20m%c3%a0%20ch%c3%bang%20ta%20s%e1%ba%bd%20build%20%c4%91%e1%bb%83%20c%c3%b3%20hi%e1%bb%83u%20h%c6%a1n%20v%e1%bb%81%20async%20communication.%20D%c6%b0%e1%bb%9bi%20%c4%91%c3%a2y%20l%c3%a0%20m%e1%bb%99t%20v%c3%a0i%20ch%c3%ba%20%c3%bd%20v%e1%bb%81%20project%20ti%e1%ba%bfp%20theo%20ch%c3%bang%20ta%20s%e1%ba%bd%20build." aria-label=Tumblr>
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fbackend%2fmicroservices-with-node-p2%2f&t=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%202%20-%20m%e1%bb%99t%20mini-microservices%20app" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2021 ducnguyen96
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
</html>
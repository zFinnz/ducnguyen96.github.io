<!doctype html><html lang=vi-vn>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Microservices vá»›i NodeJS pháº§n 4 - Äiá»u phá»‘i services vá»›i Kubernetes | Thá»‰nh thoáº£ng Ä‘Ã´i lá»i</title>
<link rel=canonical href=/posts/backend/microservices-with-node-p4/>
<meta name=description content="LÃ  nÆ¡i chia sáº» láº¡i nhá»¯ng kiáº¿n thá»©c, kinh nghiá»‡m mÃ¬nh tiáº¿p thu Ä‘Æ°á»£c trong quÃ¡ trÃ¬nh há»c táº­p vÃ  lÃ m viá»‡c. VÃ  thá»‰nh thoáº£ng cÅ©ng Ä‘Äƒng má»™t vÃ i demo ngá»› ngáº©n ná»¯a :smile:">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="Microservices vá»›i NodeJS pháº§n 4 - Äiá»u phá»‘i services vá»›i Kubernetes">
<meta property="og:description" content="Installing Kubernetes CÃ i Ä‘áº·t theo á»Ÿ Ä‘Ã¢y nhÃ©.
LÆ°u Ã½: Sau khi cÃ i Ä‘áº·t kubectl, Ä‘á»ƒ cháº¡y 1 cluster trÃªn mÃ¡y local cá»§a báº¡n thÃ¬ ta sáº½ sá»­ dá»¥ng thÃªm 1 tool gá»i lÃ  minikube. Báº¡n Ä‘á»c tÃ¬m hiá»ƒu thÃªm á»Ÿ Ä‘Ã¢y
A Quick Kubernetes Tour Nhá»¯ng thuáº­t ngá»¯ quan trá»ng trong Kubernetes  Kubernetes Cluster bao gá»“m má»™t hoáº·c nhiá»u nodes (má»—i node lÃ  má»™t mÃ¡y áº£o) vÃ  1 Master Ä‘á»ƒ quáº£n lÃ½ cÃ¡c nodes.">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/backend/microservices-with-node-p4/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-09-12T00:00:00+00:00">
<meta property="article:modified_time" content="2021-09-12T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Microservices vá»›i NodeJS pháº§n 4 - Äiá»u phá»‘i services vá»›i Kubernetes">
<meta name=twitter:description content="Installing Kubernetes CÃ i Ä‘áº·t theo á»Ÿ Ä‘Ã¢y nhÃ©.
LÆ°u Ã½: Sau khi cÃ i Ä‘áº·t kubectl, Ä‘á»ƒ cháº¡y 1 cluster trÃªn mÃ¡y local cá»§a báº¡n thÃ¬ ta sáº½ sá»­ dá»¥ng thÃªm 1 tool gá»i lÃ  minikube. Báº¡n Ä‘á»c tÃ¬m hiá»ƒu thÃªm á»Ÿ Ä‘Ã¢y
A Quick Kubernetes Tour Nhá»¯ng thuáº­t ngá»¯ quan trá»ng trong Kubernetes  Kubernetes Cluster bao gá»“m má»™t hoáº·c nhiá»u nodes (má»—i node lÃ  má»™t mÃ¡y áº£o) vÃ  1 Master Ä‘á»ƒ quáº£n lÃ½ cÃ¡c nodes.">
<link rel=stylesheet href=/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=/images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=/posts/backend/microservices-with-node-p3/ aria-label=Previous>
<i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=/posts/backend/microservices-with-node-p5/ aria-label=Next>
<i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f" aria-label=Facebook>
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&text=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&is_video=false&description=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Pinterest>
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes&body=Check out this article: %2fposts%2fbackend%2fmicroservices-with-node-p4%2f" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&name=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes&description=Installing%20Kubernetes%20C%c3%a0i%20%c4%91%e1%ba%b7t%20theo%20%e1%bb%9f%20%c4%91%c3%a2y%20nh%c3%a9.%0aL%c6%b0u%20%c3%bd%3a%20Sau%20khi%20c%c3%a0i%20%c4%91%e1%ba%b7t%20kubectl%2c%20%c4%91%e1%bb%83%20ch%e1%ba%a1y%201%20cluster%20tr%c3%aan%20m%c3%a1y%20local%20c%e1%bb%a7a%20b%e1%ba%a1n%20th%c3%ac%20ta%20s%e1%ba%bd%20s%e1%bb%ad%20d%e1%bb%a5ng%20th%c3%aam%201%20tool%20g%e1%bb%8di%20l%c3%a0%20minikube.%20B%e1%ba%a1n%20%c4%91%e1%bb%8dc%20t%c3%acm%20hi%e1%bb%83u%20th%c3%aam%20%e1%bb%9f%20%c4%91%c3%a2y%0aA%20Quick%20Kubernetes%20Tour%20Nh%e1%bb%afng%20thu%e1%ba%adt%20ng%e1%bb%af%20quan%20tr%e1%bb%8dng%20trong%20Kubernetes%20%20Kubernetes%20Cluster%20bao%20g%e1%bb%93m%20m%e1%bb%99t%20ho%e1%ba%b7c%20nhi%e1%bb%81u%20nodes%20%28m%e1%bb%97i%20node%20l%c3%a0%20m%e1%bb%99t%20m%c3%a1y%20%e1%ba%a3o%29%20v%c3%a0%201%20Master%20%c4%91%e1%bb%83%20qu%e1%ba%a3n%20l%c3%bd%20c%c3%a1c%20nodes." aria-label=Tumblr>
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&t=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#installing-kubernetes>Installing Kubernetes</a></li>
<li><a href=#a-quick-kubernetes-tour>A Quick Kubernetes Tour</a></li>
<li><a href=#nhá»¯ng-thuáº­t-ngá»¯-quan-trá»ng-trong-kubernetes>Nhá»¯ng thuáº­t ngá»¯ quan trá»ng trong Kubernetes</a></li>
<li><a href=#má»™t-vÃ i-lÆ°u-Ã½-vá»›i-config-files>Má»™t vÃ i lÆ°u Ã½ vá»›i config files.</a></li>
<li><a href=#creating-a-pod>Creating a Pod</a></li>
<li><a href=#understanding-a-pod-spec>Understanding a Pod Spec</a></li>
<li><a href=#common-kubectl-commands>Common Kubectl Commands</a></li>
<li><a href=#introducing-deployments>Introducing Deployments</a></li>
<li><a href=#createing-a-deployments>Createing A Deployments</a></li>
<li><a href=#common-commands-around-deployments>Common Commands Around Deployments</a></li>
<li><a href=#networking-with-services>Networking With Services</a></li>
<li><a href=#creating-a-nodeport-service>Creating A NodePort Service</a></li>
<li><a href=#setting-up-cluster-ip-services>Setting Up Cluster IP Services</a>
<ul>
<li><a href=#building-a-deployment-and-clusterip-for-the-event-bus>Building A Deployment and ClusterIP For The Event Bus</a></li>
</ul>
</li>
<li><a href=#communicate-between-services>Communicate Between Services</a></li>
<li><a href=#load-balancer-services>Load Balancer Services</a>
<ul>
<li><a href=#load-balancers-and-ingress>Load Balancers and Ingress</a></li>
<li><a href=#ingress-nginx>ingress-nginx</a></li>
</ul>
</li>
<li><a href=#skaffold>Skaffold</a>
<ul>
<li><a href=#installation>Installation</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
Microservices vá»›i NodeJS pháº§n 4 - Äiá»u phá»‘i services vá»›i Kubernetes
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2021-09-12 00:00:00 +0000 UTC" itemprop=datePublished>2021-09-12</time>
</div>
<div class=article-category>
<i class="fas fa-archive"></i>
<a class=category-link href=/categories/backend>backend</a>
,
<a class=category-link href=/categories/devops>devops</a>
</div>
<div class=article-tag>
<i class="fas fa-tag"></i>
<a class=tag-link href=/tags/microservices rel=tag>microservices</a>
,
<a class=tag-link href=/tags/nodejs rel=tag>nodejs</a>
,
<a class=tag-link href=/tags/monoliths rel=tag>monoliths</a>
,
<a class=tag-link href=/tags/architecture rel=tag>architecture</a>
,
<a class=tag-link href=/tags/backend rel=tag>backend</a>
,
<a class=tag-link href=/tags/devops rel=tag>devops</a>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<h2 id=installing-kubernetes>Installing Kubernetes</h2>
<p>CÃ i Ä‘áº·t theo <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-using-native-package-management>á»Ÿ Ä‘Ã¢y</a> nhÃ©.</p>
<p>LÆ°u Ã½: Sau khi cÃ i Ä‘áº·t kubectl, Ä‘á»ƒ cháº¡y 1 cluster trÃªn mÃ¡y local cá»§a báº¡n thÃ¬ ta sáº½ sá»­ dá»¥ng thÃªm 1 tool gá»i lÃ  minikube. Báº¡n Ä‘á»c tÃ¬m hiá»ƒu thÃªm á»Ÿ <a href=https://minikube.sigs.k8s.io/docs/start/>Ä‘Ã¢y</a></p>
<h2 id=a-quick-kubernetes-tour>A Quick Kubernetes Tour</h2>
<p><img src=/images/microservices-dg-66.png alt=microservices-dg-66></p>
<h2 id=nhá»¯ng-thuáº­t-ngá»¯-quan-trá»ng-trong-kubernetes>Nhá»¯ng thuáº­t ngá»¯ quan trá»ng trong Kubernetes</h2>
<p><img src=/images/microservices-dg-67.png alt=microservices-dg-67></p>
<ul>
<li>Kubernetes Cluster bao gá»“m má»™t hoáº·c nhiá»u nodes (má»—i node lÃ  má»™t mÃ¡y áº£o) vÃ  1 Master Ä‘á»ƒ quáº£n lÃ½ cÃ¡c nodes. Kubernetes á»Ÿ local máº·c Ä‘á»‹nh sáº½ cÃ³ 1 node.</li>
<li>Má»—i node lÃ  má»™t mÃ¡y áº£o cháº¡y cÃ¡c containers.</li>
<li>Pod tÆ°Æ¡ng tá»± nhÆ° 1 container, vá» máº·t ká»¹ thuáº­t thÃ¬ 1 pod cÃ³ thá»ƒ cháº¡y nhiá»u containers nhÆ°ng ta sáº½ tÃ¬m hiá»ƒu sau nhÃ©.</li>
<li>Deployment: quáº£n lÃ½ cÃ¡c pods, restart chÃºng náº¿u chÃºng bá»‹ crash.</li>
<li>Service: cung cáº¥p má»™t URL dá»… nhá»› Ä‘á»ƒ truy cáº­p vÃ o container.(cháº³ng háº¡n thay vÃ¬ localhost:4001 thÃ¬ URL sáº½ lÃ  postservice)</li>
</ul>
<h2 id=má»™t-vÃ i-lÆ°u-Ã½-vá»›i-config-files>Má»™t vÃ i lÆ°u Ã½ vá»›i config files.</h2>
<p><img src=/images/microservices-dg-68.png alt=microservices-dg-68></p>
<ul>
<li>
<p>Config files nÃ³i vá»›i Kubernetes vá» cÃ¡c deployments, pods vÃ  services khÃ¡c nhau (chÃºng Ä‘Æ°á»£c xem nhÆ° lÃ  cÃ¡c Objects) mÃ  ta muá»‘n táº¡o.</p>
</li>
<li>
<p>ÄÆ°á»£c viáº¿t báº±ng YAML syntax.</p>
</li>
<li>
<p>LuÃ´n lÆ°u nhá»¯ng config files nÃ y vÃ o source code. ÄÃ¢y lÃ  document ráº¥t quan trá»ng, nÃ³ giÃºp cho enginner hiá»ƒu Ä‘Æ°á»£c cáº¥u trÃºc dá»± Ã¡n.</p>
</li>
<li>
<p>Ta cÃ³ thá»ƒ táº¡o Ä‘Æ°á»£c Kubernetes Objects mÃ  khÃ´ng cáº§n config files - tuy nhiÃªn thÃ¬ khuyáº¿n khÃ­ch lÃ  khÃ´ng lÃ m nhÆ° váº­y. Config files cung cáº¥p Ä‘á»‹nh nghÄ©a chÃ­nh xÃ¡c cho Kubernetes viá»‡c cáº§n lÃ m, hÆ¡n ná»¯a thÃ¬ config files nhÆ° Ä‘Ã£ nÃ³i thÃ¬ nÃ³ cÅ©ng lÃ  document giÃºp ngÆ°á»i khÃ¡c hiá»ƒu hÆ¡n vá» project.</p>
</li>
<li>
<p>TÃ i liá»‡u cá»§a Kubernetes hÆ°á»›ng dáº«n báº¡n táº¡o objects báº±ng command - tuy nhiÃªn thÃ¬ chá»‰ nÃªn lÃ m váº­y Ä‘á»ƒ test thÃ´i nhÃ©.</p>
</li>
</ul>
<h2 id=creating-a-pod>Creating a Pod</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-postservice:0.0.1</span>
</code></pre></div><p>TrÆ°á»›c khi apply config file hÃ£y cháº¯c cháº¯n lÃ  Ä‘ang cháº¡y 1 cluster trÃªn mÃ¡y cá»§a mÃ¬nh nhÃ©. Náº¿u chÆ°a thÃ¬ sá»­ dá»¥ng <code>minikube start</code> Ä‘á»ƒ táº¡o 1 cluster nhÃ©.\</p>
<p>LÆ°u Ã½: Khi <code>minikube start</code> báº¡n sáº½ táº¡o ra 1 mÃ¡y áº£o trÃªn mÃ¡y local cá»§a báº¡n, docker images trÃªn local sáº½ khÃ´ng tá»“n táº¡i trÃªn con VM nÃ y. ChÃ­nh vÃ¬ tháº¿ báº¡n cÃ³ 2 cÃ¡ch: 1 lÃ  Ä‘áº©y image báº¡n build tá»« local lÃªn 1 registry nÃ o Ä‘áº¥y vÃ  VM sáº½ pull tá»« Ä‘áº¥y vá», 2 lÃ  báº¡n sáº½ build image ngay trong VM báº±ng cÃ¡ch sá»­ dá»¥ng command <code>eval $(minikube docker-env)</code>, sau khi cháº¡y command nÃ y á»Ÿ 1 terminal cá»¥ thá»ƒ nÃ o Ä‘áº¥y, báº¡n cÃ³ thá»ƒ kiá»ƒm tra báº±ng <code>docker images</code>. Náº¿u tháº¥y káº¿t quáº£ tráº£ ra khÃ¡c vá»›i local thÃ¬ báº¡n cÃ³ thá»ƒ build image rá»“i Ä‘áº¥y. Tham kháº£o thÃªm <a href=https://github.com/kubernetes/minikube/blob/0c616a6b42b28a1aab8397f5a9061f8ebbd9f3d9/README.md#reusing-the-docker-daemon>á»Ÿ Ä‘Ã¢y</a> nhÃ©.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>docker build -t ducnguyen96/mini-microservice-postservice:0.0.1 .
</code></pre></div><p>Kiá»ƒm tra láº¡i vá»›i <code>docker images</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl apply -f posts.yaml
</code></pre></div><p><img src=/images/microservices-dg-70.png alt=microservices-dg-70></p>
<h2 id=understanding-a-pod-spec>Understanding a Pod Spec</h2>
<p><img src=/images/microservices-dg-69.png alt=microservices-dg-69>
K8s cÃ³ tÃ­nh má»Ÿ rá»™ng cá»±c ká»³ cao, ta cÃ³ thá»ƒ táº¡o cÃ¡c Custom Objects.</p>
<ul>
<li>apiVersion: PhiÃªn báº£n Kubernetes API mÃ  chÃºng ta sáº½ sá»­ dá»¥ng Ä‘á»ƒ táº¡o object</li>
<li>kind: loáº¡i object</li>
<li>metadata: má»™t sá»‘ config options cho object, cháº³ng háº¡n name cá»§a Pod lÃ  posts.</li>
<li>spec: cÃ¡c thuá»™c tÃ­nh cá»§a object mÃ  ta sáº½ táº¡o.</li>
<li>containers: 1 array cÃ¡c containers, má»—i container báº¯t Ä‘áº§u báº±ng -.</li>
</ul>
<p>á» Ä‘Ã¢y ta tháº¥y tÃªn pod vÃ  tÃªn container trÃ¹ng nhau, liá»‡u cÃ³ áº£nh hÆ°á»Ÿng gÃ¬ khÃ´ng, cÃ³ pháº£i bad practice khÃ´ng ?. NhÆ° báº¡n tháº¥y thÃ¬ Pod nÃ y chá»‰ cÃ³ 1 container duy nháº¥t lÃ  posts nÃªn vá» máº·t ngá»¯ nghÄ©a thÃ¬ cÅ©ng khÃ¡ chÃ­nh xÃ¡c khi Ä‘áº·t tÃªn pod trÃ¹ng vá»›i tÃªn container, tuy nhiÃªn lÃºc pod cÃ³ nhiá»u containers thÃ¬ báº¡n cÃ³ thá»ƒ thay Ä‘á»•i tÃªn pod cho há»£p lÃ½ hÆ¡n, viá»‡c nÃ y cÅ©ng khÃ´ng áº£nh hÆ°á»Ÿng gÃ¬ nhiá»u (khÃ´ng gÃ¢y lá»—i.)</p>
<p>Má»™t lÆ°u Ã½ vá»›i container image: náº¿u kubernetes khÃ´ng tháº¥y image á»Ÿ local thÃ¬ nÃ³ sáº½ máº·c Ä‘á»‹nh tÃ¬m image á»Ÿ Docker Hub, vÃ  náº¿u báº¡n khÃ´ng cung cáº¥p version (0.0.1) thÃ¬ máº·c Ä‘á»‹nh nÃ³ sáº½ pull image vá»›i tag lastest.</p>
<h2 id=common-kubectl-commands>Common Kubectl Commands</h2>
<p><img src=/images/microservices-dg-71.png alt=microservices-dg-71></p>
<h2 id=introducing-deployments>Introducing Deployments</h2>
<p><img src=/images/microservices-dg-72.png alt=microservices-dg-72>
Deployment lÃ  má»™t object Ä‘Æ°á»£c táº¡o ra Ä‘á»ƒ quáº£n lÃ½ cÃ¡c Pod. Deployment cÃ³ 2 nhiá»‡m vá»¥ chÃ­nh:</p>
<ul>
<li>Náº¿u cÃ³ 1 pod bá»—ng nhiÃªn bá»‹ crash thÃ¬ deployment sáº½ tá»± Ä‘á»™ng táº¡o láº¡i pod Ä‘Ã³.</li>
<li>Chá»‹u trÃ¡ch nhiá»‡m update cÃ¡c phiÃªn báº£n image má»›i hÆ¡n cho tá»«ng pod.</li>
</ul>
<h2 id=createing-a-deployments>Createing A Deployments</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts-depl</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>containers</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-postservice:0.0.1</span>
</code></pre></div><ul>
<li>selector: NhÃ¬n vÃ o táº¥t cáº£ pods, tÃ¬m pods nÃ o cÃ³ label cá»§a app lÃ  posts vÃ  quáº£n lÃ½ chÃºng.</li>
<li>template: config pod</li>
<li>spec: pod spec</li>
</ul>
<h2 id=common-commands-around-deployments>Common Commands Around Deployments</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># List all the running deployments</span>
kubectl get deployments
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># Print out details about a specific deployment</span>
kubectl describe deployment <span style=color:#f92672>[</span>depl name<span style=color:#f92672>]</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># Create a deployment out of a config file</span>
kubectl apply f- <span style=color:#f92672>[</span>config file name<span style=color:#f92672>]</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># Delete a deployment</span>
kubectl delete deployment <span style=color:#f92672>[</span>depl name<span style=color:#f92672>]</span>
</code></pre></div><h2 id=networking-with-services>Networking With Services</h2>
<p><img src=/images/microservices-dg-74.png alt=microservices-dg-74>
Äá»ƒ cÃ¡c pod cÃ³ thá»ƒ giao tiáº¿p vá»›i nhau vÃ  bÃªn ngoÃ i cÃ³ thá»ƒ giao tiáº¿p vá»›i pod thÃ¬ kubernetes cung cáº¥p cho ta 1 loáº¡i object Ä‘á»ƒ thá»±c hiá»‡n viá»‡c nÃ y - service.</p>
<p>CÃ³ má»™t sá»‘ loáº¡i services sau Ä‘Ã¢y:
<img src=/images/microservices-dg-75.png alt=microservices-dg-75></p>
<ul>
<li>Cluster IP: truy cáº­p vÃ o pods trong cÃ¹ng 1 cluster.</li>
<li>Node Port: truy cáº­p vÃ o pod tá»« bÃªn ngoÃ i, thÆ°á»ng sá»­ dá»¥ng cho dev env.</li>
<li>Load Balancer: truy cáº­p vÃ o pod tá»« bÃªn ngoÃ i.</li>
<li>External Name: thÆ°á»ng ráº¥t Ä‘Æ°á»£c sá»­ dá»¥ng cho 1 vÃ i trÆ°á»ng há»£p Ä‘áº·c biá»‡t.</li>
</ul>
<h2 id=creating-a-nodeport-service>Creating A NodePort Service</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#75715e># posts-srv.yml</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts-srv</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
  <span style=color:#f92672>ports</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>4000</span>
      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>4000</span>
</code></pre></div><p>á» pháº§n trÃªn ta Ä‘Ã£ táº¡o 1 Deployment vá»›i metadata chá»©a labels: <code>app: posts</code>. Giá» ta muá»‘n expose nhá»¯ng pod cá»§a delpoyment Ä‘Ã³ ra ngoÃ i Ä‘á»ƒ cÃ³ thá»ƒ access tá»« browser, thÃ¬ service má»›i táº¡o nÃ y cÃ³ selector lÃ  <code>app: posts</code> nÃ³ sáº½ tÃ¬m táº¥t cáº£ cÃ¡c pod cÃ³ label nÃ y Ä‘á»ƒ Ã¡p dá»¥ng config.</p>
<p><img src=/images/microservices-dg-76.png alt=microservices-dg-76>
Theo hÃ¬nh trÃªn ta cÃ³ thá»ƒ tháº¥y, Node lÃ  má»™t mÃ¡y áº£o Ä‘ang cháº¡y cÃ¡c kubernetes objects lÃ  NodePort Service vÃ  Pod. Pod cá»§a chÃºng ta Ä‘ang cháº¡y image cá»§a post service, nÃ³ dang listen á»Ÿ cá»•ng 4000. NodePort Service lÃ  1 object riÃªng giÃºp ta giao tiáº¿p vá»›i Pod, vÃ  nÃ³ cÅ©ng cÃ³ 1 port riÃªng</p>
<p>Äá»ƒ giao tiáº¿p Ä‘Æ°á»£c vá»›i pod thÃ¬ trÆ°á»›c tiÃªn ta pháº£i qua Node sau Ä‘Ã³ Ä‘áº¿n NodePort service. Äá»ƒ xem Ä‘á»‹a chá»‰ ip cá»§a Node minikube ta sáº½ inspect container minikube.</p>
<p><img src=/images/microservices-dg-77.png alt=microservices-dg-77></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>docker inspect 0d8db750f273
</code></pre></div><p><img src=/images/microservices-dg-78.png alt=microservices-dg-78></p>
<p>KÃ©o xuá»‘ng pháº§n network ta cÃ³ thá»ƒ tháº¥y Ä‘Æ°á»£c Ä‘á»‹a chá»‰ ip cá»§a minikube.</p>
<p><img src=/images/microservices-dg-79.png alt=microservices-dg-79>
Váº­y giá» ta cÃ³ thá»ƒ giao tiáº¿p Ä‘Æ°á»£c vá»›i pod posts qua <code>192.168.49.2:31331</code>
<img src=/images/microservices-dg-80.png alt=microservices-dg-80></p>
<h2 id=setting-up-cluster-ip-services>Setting Up Cluster IP Services</h2>
<p>Má»¥c Ä‘Ã­ch cá»§a Cluster IP lÃ  expose 1 pod Ä‘áº¿n nhá»¯ng pods khÃ¡c trong cÃ¹ng 1 cluster. TrÆ°á»›c háº¿t ta hÃ£y xem láº¡i cÃ¡ch app cá»§a chÃºng ta hoáº¡t Ä‘á»™ng Ä‘Ã£ nhÃ¡.</p>
<p>Khi ngÆ°á»i dÃ¹ng muá»‘n táº¡o post, ta sáº½ emit 1 event Ä‘áº¿n event bus, sau Ä‘áº¥y thÃ¬ event sáº½ emit event Ä‘Ã³ Ä‘áº¿n toÃ n bá»™ pods ká»ƒ cáº£ post Ä‘á»ƒ táº¡o post.</p>
<p>Vá» máº·t ká»¹ thuáº­t thÃ¬ cÃ¡c pod cÃ³ thá»ƒ giao tiáº¿p trá»±c tiáº¿p vá»›i nhau nhÆ°ng chÃºng sáº½ cÃ³ ip ngáº«u nhiÃªn vÃ  khÃ³ nhá»›, cÃ³ thá»ƒ thay Ä‘á»•i sau nhá»¯ng láº§n update. VÃ¬ tháº¿ cÃ¡c pod sáº½ giao tiáº¿p vá»›i nhau qua cluster ip.</p>
<h3 id=building-a-deployment-and-clusterip-for-the-event-bus>Building A Deployment and ClusterIP For The Event Bus</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>event-bus-depl</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>event-bus</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>event-bus</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>containers</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>event-bus</span>
          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-eventbus:0.0.1</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>event-bus-srv</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>event-bus</span>
  <span style=color:#f92672>ports</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>event-bus</span>
      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>4005</span>
      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>4005</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl apply -f event-bus-depl.yml
</code></pre></div><p>Ta cÃ³ thá»ƒ tÃ¡ch tá»«ng file riÃªng cho tá»«ng kebernetes objects, tuy nhiÃªn á»Ÿ Ä‘Ã¢y mÃ¬nh prefer gá»™p láº¡i lÃ  1 hÆ¡n.</p>
<p>TÆ°Æ¡ng tá»± thÃ¬ ta cÅ©ng thÃªm ClusterIP cho postservice</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts-depl</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>containers</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-postservice:0.0.1</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts-clusterip-srv</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
  <span style=color:#f92672>ports</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>4000</span>
      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>4000</span>
</code></pre></div><h2 id=communicate-between-services>Communicate Between Services</h2>
<p>Máº·c dÃ¹ minikube Ä‘ang cháº¡y trÃªn mÃ¡y local nhÆ°ng cÃ¡c pod trong minikube thÃ¬ khÃ´ng thá»ƒ giao tiáº¿p vá»›i nhau qua localhost, hiá»‡n táº¡i ta Ä‘Ã£ táº¡o ClusterIP cho postservice vÃ  eventbus, 2 pod nÃ y cÃ³ thá»ƒ giao tiáº¿p vá»›i nhau qua ClusterIP, váº­y ta pháº£i thay Ä‘á»•i Ä‘á»‹a chá»‰ IP cá»§a chÃºng nhÆ° sau:
<img src=/images/microservices-dg-81.png alt=microservices-dg-81>
Post muá»‘n gá»­i request Ä‘áº¿n eventbus (port 4005) thay vÃ¬ <code>localhost:4005</code> thÃ¬ ta thay báº±ng <code>http://event-bus-srv:4005</code></p>
<h2 id=load-balancer-services>Load Balancer Services</h2>
<p><img src=/images/microservices-dg-82.png alt=microservices-dg-82>
á» Initial load page, vá»›i client-side-rendering app nhÆ° create-react-app thÃ¬ server chá»‰ tráº£ vá» HTML + JS + CSS chÆ°a kÃ¨m data, nÃªn chÃºng ta chÆ°a cáº§n quan tÃ¢m Ä‘áº¿n viá»‡c giao tiáº¿p giá»¯a client vÃ  cÃ¡c services khÃ¡c.</p>
<p>Tuy nhiÃªn, khi Ä‘Ã£ load Ä‘Æ°á»£c html + js rá»“i, user requests posts thÃ¬ lÃºc nÃ y ta cáº§n giao tiáº¿p giá»¯a react-app vÃ  cÃ¡c services khÃ¡c nhÆ° posts, comments. Ta cÃ³ 2 cÃ¡ch giáº£i quyáº¿t nhÆ° sau:</p>
<p><img src=/images/microservices-dg-83.png alt=microservices-dg-83>
CÃ¡ch Ä‘áº§u tiÃªn nhÆ° á»Ÿ phÃ­a trÃªn Ä‘Ã£ cÃ³ vÃ­ dá»¥ vá» posts, má»—i pod sáº½ Ä‘Æ°á»£c gáº¯n vá»›i 1 node port riÃªng vÃ  vá»›i tá»«ng request thÃ¬ react-app sáº½ gá»­i Ä‘áº¿n tá»«ng port khÃ¡c nhau. Tuy nhiÃªn nhÆ° báº¡n Ä‘ang nghÄ© Ä‘áº¥y, vá»›i má»—i nodeport thÃ¬ kubernetes sáº½ random gÃ¡n vá»›i 1 port, sáº½ tháº¿ nÃ o náº¿u 1 lÃºc nÃ o Ä‘Ã³ port nÃ y bá»‹ Ä‘á»•i ? báº¡n sáº½ pháº£i Ä‘áº¿n react-app code vÃ  thay Ä‘á»•i tá»«ng request má»™t.</p>
<p><img src=/images/microservices-dg-84.png alt=microservices-dg-84>
CÃ¡ch thá»© 2 lÃ  sá»­ dá»¥ng load balancer - chá»§ Ä‘á» cá»§a pháº§n nÃ y. Ta sáº½ cÃ³ 1 endpoint duy nháº¥t Ä‘á»ƒ react-app káº¿t ná»‘i Ä‘áº¿n vÃ  balancer nÃ y sáº½ map tá»«ng request Ä‘áº¿n tá»«ng pod cáº§n thiáº¿t.</p>
<h3 id=load-balancers-and-ingress>Load Balancers and Ingress</h3>
<p><img src=/images/microservices-dg-85.png alt=microservices-dg-85></p>
<ul>
<li>Hiá»ƒu má»™t cÃ¡ch Ä‘Æ¡n giáº£n thÃ¬ Load Balancer giÃºp route request tá»« bÃªn ngoÃ i Ä‘áº¿n cluster.</li>
<li>Ingress lÃ  pod trong kubernetes nháº­n request tá»« loadbalancer vÃ  route Ä‘áº¿n tá»«ng pod cá»¥ thá»ƒ.</li>
</ul>
<h3 id=ingress-nginx>ingress-nginx</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>minikube addons enable ingress
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ingress-srv</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>ingress-nginx</span>
  <span style=color:#f92672>annotations</span>:
    <span style=color:#f92672>kubernetes.io/ingress.class</span>: <span style=color:#ae81ff>nginx</span>
    <span style=color:#f92672>nginx.ingress.kubernetes.io/use-regex</span>: <span style=color:#e6db74>&#34;true&#34;</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>rules</span>:
    - <span style=color:#f92672>host</span>: <span style=color:#ae81ff>posts.com</span>
      <span style=color:#f92672>http</span>:
        <span style=color:#f92672>paths</span>:
          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/posts/create</span>
            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
            <span style=color:#f92672>backend</span>:
              <span style=color:#f92672>service</span>:
                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts-clusterip-srv</span>
                <span style=color:#f92672>port</span>:
                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>4000</span>
          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/posts</span>
            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
            <span style=color:#f92672>backend</span>:
              <span style=color:#f92672>service</span>:
                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>query-clusterip-srv</span>
                <span style=color:#f92672>port</span>:
                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>4002</span>
          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>posts/?(.*)/comments</span>
            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
            <span style=color:#f92672>backend</span>:
              <span style=color:#f92672>service</span>:
                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>comment-clusterip-srv</span>
                <span style=color:#f92672>port</span>:
                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>4001</span>
          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/?(.*)</span>
            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
            <span style=color:#f92672>backend</span>:
              <span style=color:#f92672>service</span>:
                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>client-clusterip-srv</span>
                <span style=color:#f92672>port</span>:
                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>3000</span>
</code></pre></div><p>Finish Route Config. LÆ°u Ã½ thÃ¬ ingress-nginx khÃ´ng cÃ³ rules Ä‘á»ƒ phÃ¢n biá»‡t request methods: POST, GET, vÃ¬ váº­y ta pháº£i cÃ³ unique path.
<img src=/images/microservices-dg-86.png alt=microservices-dg-86></p>
<p>Sau khi Ä‘Ã£ config xong toÃ n bá»™, ta apply config:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl apply -f ../k8s -n<span style=color:#f92672>=</span>ingress-nginx
</code></pre></div><p>Láº¥y ip cá»§a ingress</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get ingress -n<span style=color:#f92672>=</span>ingress-nginx
</code></pre></div><p><img src=/images/microservices-dg-87.png alt=microservices-dg-87></p>
<p>Update ip vÃ o hosts file <code>/etc/hosts</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo nano /etc/hosts
</code></pre></div><p><img src=/images/microservices-dg-88.png alt=microservices-dg-88></p>
<p>Váº­y lÃ  app cá»§a ta Ä‘Æ°á»£c deploy vÃ  cháº¡y ngon lÃ nh rá»“i ğŸ’“. Tuy nhiÃªn quÃ¡ trÃ¬nh development thÃ¬ tráº£i nghiá»‡m khÃ´ng Ä‘Æ°á»£c tá»‘t, vÃ¬ má»—i láº§n update code ta láº¡i pháº£i build image rá»“i sá»­a config file xong má»›i deploy Ä‘á»ƒ test káº¿t quáº£.</p>
<p>Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y thÃ¬ sinh ra 1 tool lÃ  <code>Skaffold</code>.</p>
<h2 id=skaffold>Skaffold</h2>
<h3 id=installation>Installation</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>curl -Lo skaffold https://storage.googleapis.com/skaffold/releases/latest/skaffold-linux-amd64 <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>sudo install skaffold /usr/local/bin/
</code></pre></div><p>Config Skaffold</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>skaffold/v2beta21</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Config</span>
<span style=color:#f92672>deploy</span>:
  <span style=color:#f92672>kubectl</span>:
    <span style=color:#f92672>manifests</span>:
      - <span style=color:#ae81ff>./infa/k8s/*</span>
<span style=color:#f92672>build</span>:
  <span style=color:#f92672>local</span>:
    <span style=color:#f92672>push</span>: <span style=color:#66d9ef>false</span>
  <span style=color:#f92672>artifacts</span>:
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-client</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>client</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-commentservice</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>comments</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-eventbus</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>events</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-moderationservice</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>moderation</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-postservice</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>posts</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-queryservice</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>query</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
</code></pre></div>
</div>
</article>
<div class=blog-post-comments>
<div id=disqus_thread>
<script type=text/javascript>(function(){var a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,b='ducnguyen96',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</div>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li><a href=#installing-kubernetes>Installing Kubernetes</a></li>
<li><a href=#a-quick-kubernetes-tour>A Quick Kubernetes Tour</a></li>
<li><a href=#nhá»¯ng-thuáº­t-ngá»¯-quan-trá»ng-trong-kubernetes>Nhá»¯ng thuáº­t ngá»¯ quan trá»ng trong Kubernetes</a></li>
<li><a href=#má»™t-vÃ i-lÆ°u-Ã½-vá»›i-config-files>Má»™t vÃ i lÆ°u Ã½ vá»›i config files.</a></li>
<li><a href=#creating-a-pod>Creating a Pod</a></li>
<li><a href=#understanding-a-pod-spec>Understanding a Pod Spec</a></li>
<li><a href=#common-kubectl-commands>Common Kubectl Commands</a></li>
<li><a href=#introducing-deployments>Introducing Deployments</a></li>
<li><a href=#createing-a-deployments>Createing A Deployments</a></li>
<li><a href=#common-commands-around-deployments>Common Commands Around Deployments</a></li>
<li><a href=#networking-with-services>Networking With Services</a></li>
<li><a href=#creating-a-nodeport-service>Creating A NodePort Service</a></li>
<li><a href=#setting-up-cluster-ip-services>Setting Up Cluster IP Services</a>
<ul>
<li><a href=#building-a-deployment-and-clusterip-for-the-event-bus>Building A Deployment and ClusterIP For The Event Bus</a></li>
</ul>
</li>
<li><a href=#communicate-between-services>Communicate Between Services</a></li>
<li><a href=#load-balancer-services>Load Balancer Services</a>
<ul>
<li><a href=#load-balancers-and-ingress>Load Balancers and Ingress</a></li>
<li><a href=#ingress-nginx>ingress-nginx</a></li>
</ul>
</li>
<li><a href=#skaffold>Skaffold</a>
<ul>
<li><a href=#installation>Installation</a></li>
</ul>
</li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f" aria-label=Facebook>
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&text=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&is_video=false&description=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Pinterest>
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes&body=Check out this article: %2fposts%2fbackend%2fmicroservices-with-node-p4%2f" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&name=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes&description=Installing%20Kubernetes%20C%c3%a0i%20%c4%91%e1%ba%b7t%20theo%20%e1%bb%9f%20%c4%91%c3%a2y%20nh%c3%a9.%0aL%c6%b0u%20%c3%bd%3a%20Sau%20khi%20c%c3%a0i%20%c4%91%e1%ba%b7t%20kubectl%2c%20%c4%91%e1%bb%83%20ch%e1%ba%a1y%201%20cluster%20tr%c3%aan%20m%c3%a1y%20local%20c%e1%bb%a7a%20b%e1%ba%a1n%20th%c3%ac%20ta%20s%e1%ba%bd%20s%e1%bb%ad%20d%e1%bb%a5ng%20th%c3%aam%201%20tool%20g%e1%bb%8di%20l%c3%a0%20minikube.%20B%e1%ba%a1n%20%c4%91%e1%bb%8dc%20t%c3%acm%20hi%e1%bb%83u%20th%c3%aam%20%e1%bb%9f%20%c4%91%c3%a2y%0aA%20Quick%20Kubernetes%20Tour%20Nh%e1%bb%afng%20thu%e1%ba%adt%20ng%e1%bb%af%20quan%20tr%e1%bb%8dng%20trong%20Kubernetes%20%20Kubernetes%20Cluster%20bao%20g%e1%bb%93m%20m%e1%bb%99t%20ho%e1%ba%b7c%20nhi%e1%bb%81u%20nodes%20%28m%e1%bb%97i%20node%20l%c3%a0%20m%e1%bb%99t%20m%c3%a1y%20%e1%ba%a3o%29%20v%c3%a0%201%20Master%20%c4%91%e1%bb%83%20qu%e1%ba%a3n%20l%c3%bd%20c%c3%a1c%20nodes." aria-label=Tumblr>
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&t=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2021 ducnguyen96
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
</html>
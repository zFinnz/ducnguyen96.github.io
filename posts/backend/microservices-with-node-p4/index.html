<!doctype html><html lang=vi-vn>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Microservices với NodeJS phần 4 - Điều phối services với Kubernetes | Thỉnh thoảng đôi lời</title>
<link rel=canonical href=/posts/backend/microservices-with-node-p4/>
<meta name=description content="Là nơi chia sẻ lại những kiến thức, kinh nghiệm mình tiếp thu được trong quá trình học tập và làm việc. Và thỉnh thoảng cũng đăng một vài demo ngớ ngẩn nữa :smile:">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="Microservices với NodeJS phần 4 - Điều phối services với Kubernetes">
<meta property="og:description" content="Installing Kubernetes Cài đặt theo ở đây nhé.
Lưu ý: Sau khi cài đặt kubectl, để chạy 1 cluster trên máy local của bạn thì ta sẽ sử dụng thêm 1 tool gọi là minikube. Bạn đọc tìm hiểu thêm ở đây
A Quick Kubernetes Tour Những thuật ngữ quan trọng trong Kubernetes  Kubernetes Cluster bao gồm một hoặc nhiều nodes (mỗi node là một máy ảo) và 1 Master để quản lý các nodes.">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/backend/microservices-with-node-p4/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-09-12T00:00:00+00:00">
<meta property="article:modified_time" content="2021-09-12T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Microservices với NodeJS phần 4 - Điều phối services với Kubernetes">
<meta name=twitter:description content="Installing Kubernetes Cài đặt theo ở đây nhé.
Lưu ý: Sau khi cài đặt kubectl, để chạy 1 cluster trên máy local của bạn thì ta sẽ sử dụng thêm 1 tool gọi là minikube. Bạn đọc tìm hiểu thêm ở đây
A Quick Kubernetes Tour Những thuật ngữ quan trọng trong Kubernetes  Kubernetes Cluster bao gồm một hoặc nhiều nodes (mỗi node là một máy ảo) và 1 Master để quản lý các nodes.">
<link rel=stylesheet href=/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=/images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=/posts/backend/microservices-with-node-p3/ aria-label=Previous>
<i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=/posts/backend/microservices-with-node-p5/ aria-label=Next>
<i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f" aria-label=Facebook>
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&text=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&is_video=false&description=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Pinterest>
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes&body=Check out this article: %2fposts%2fbackend%2fmicroservices-with-node-p4%2f" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&name=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes&description=Installing%20Kubernetes%20C%c3%a0i%20%c4%91%e1%ba%b7t%20theo%20%e1%bb%9f%20%c4%91%c3%a2y%20nh%c3%a9.%0aL%c6%b0u%20%c3%bd%3a%20Sau%20khi%20c%c3%a0i%20%c4%91%e1%ba%b7t%20kubectl%2c%20%c4%91%e1%bb%83%20ch%e1%ba%a1y%201%20cluster%20tr%c3%aan%20m%c3%a1y%20local%20c%e1%bb%a7a%20b%e1%ba%a1n%20th%c3%ac%20ta%20s%e1%ba%bd%20s%e1%bb%ad%20d%e1%bb%a5ng%20th%c3%aam%201%20tool%20g%e1%bb%8di%20l%c3%a0%20minikube.%20B%e1%ba%a1n%20%c4%91%e1%bb%8dc%20t%c3%acm%20hi%e1%bb%83u%20th%c3%aam%20%e1%bb%9f%20%c4%91%c3%a2y%0aA%20Quick%20Kubernetes%20Tour%20Nh%e1%bb%afng%20thu%e1%ba%adt%20ng%e1%bb%af%20quan%20tr%e1%bb%8dng%20trong%20Kubernetes%20%20Kubernetes%20Cluster%20bao%20g%e1%bb%93m%20m%e1%bb%99t%20ho%e1%ba%b7c%20nhi%e1%bb%81u%20nodes%20%28m%e1%bb%97i%20node%20l%c3%a0%20m%e1%bb%99t%20m%c3%a1y%20%e1%ba%a3o%29%20v%c3%a0%201%20Master%20%c4%91%e1%bb%83%20qu%e1%ba%a3n%20l%c3%bd%20c%c3%a1c%20nodes." aria-label=Tumblr>
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&t=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#installing-kubernetes>Installing Kubernetes</a></li>
<li><a href=#a-quick-kubernetes-tour>A Quick Kubernetes Tour</a></li>
<li><a href=#những-thuật-ngữ-quan-trọng-trong-kubernetes>Những thuật ngữ quan trọng trong Kubernetes</a></li>
<li><a href=#một-vài-lưu-ý-với-config-files>Một vài lưu ý với config files.</a></li>
<li><a href=#creating-a-pod>Creating a Pod</a></li>
<li><a href=#understanding-a-pod-spec>Understanding a Pod Spec</a></li>
<li><a href=#common-kubectl-commands>Common Kubectl Commands</a></li>
<li><a href=#introducing-deployments>Introducing Deployments</a></li>
<li><a href=#createing-a-deployments>Createing A Deployments</a></li>
<li><a href=#common-commands-around-deployments>Common Commands Around Deployments</a></li>
<li><a href=#networking-with-services>Networking With Services</a></li>
<li><a href=#creating-a-nodeport-service>Creating A NodePort Service</a></li>
<li><a href=#setting-up-cluster-ip-services>Setting Up Cluster IP Services</a>
<ul>
<li><a href=#building-a-deployment-and-clusterip-for-the-event-bus>Building A Deployment and ClusterIP For The Event Bus</a></li>
</ul>
</li>
<li><a href=#communicate-between-services>Communicate Between Services</a></li>
<li><a href=#load-balancer-services>Load Balancer Services</a>
<ul>
<li><a href=#load-balancers-and-ingress>Load Balancers and Ingress</a></li>
<li><a href=#ingress-nginx>ingress-nginx</a></li>
</ul>
</li>
<li><a href=#skaffold>Skaffold</a>
<ul>
<li><a href=#installation>Installation</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
Microservices với NodeJS phần 4 - Điều phối services với Kubernetes
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2021-09-12 00:00:00 +0000 UTC" itemprop=datePublished>2021-09-12</time>
</div>
<div class=article-category>
<i class="fas fa-archive"></i>
<a class=category-link href=/categories/backend>backend</a>
,
<a class=category-link href=/categories/devops>devops</a>
</div>
<div class=article-tag>
<i class="fas fa-tag"></i>
<a class=tag-link href=/tags/microservices rel=tag>microservices</a>
,
<a class=tag-link href=/tags/nodejs rel=tag>nodejs</a>
,
<a class=tag-link href=/tags/monoliths rel=tag>monoliths</a>
,
<a class=tag-link href=/tags/architecture rel=tag>architecture</a>
,
<a class=tag-link href=/tags/backend rel=tag>backend</a>
,
<a class=tag-link href=/tags/devops rel=tag>devops</a>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<h2 id=installing-kubernetes>Installing Kubernetes</h2>
<p>Cài đặt theo <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-using-native-package-management>ở đây</a> nhé.</p>
<p>Lưu ý: Sau khi cài đặt kubectl, để chạy 1 cluster trên máy local của bạn thì ta sẽ sử dụng thêm 1 tool gọi là minikube. Bạn đọc tìm hiểu thêm ở <a href=https://minikube.sigs.k8s.io/docs/start/>đây</a></p>
<h2 id=a-quick-kubernetes-tour>A Quick Kubernetes Tour</h2>
<p><img src=/images/microservices-dg-66.png alt=microservices-dg-66></p>
<h2 id=những-thuật-ngữ-quan-trọng-trong-kubernetes>Những thuật ngữ quan trọng trong Kubernetes</h2>
<p><img src=/images/microservices-dg-67.png alt=microservices-dg-67></p>
<ul>
<li>Kubernetes Cluster bao gồm một hoặc nhiều nodes (mỗi node là một máy ảo) và 1 Master để quản lý các nodes. Kubernetes ở local mặc định sẽ có 1 node.</li>
<li>Mỗi node là một máy ảo chạy các containers.</li>
<li>Pod tương tự như 1 container, về mặt kỹ thuật thì 1 pod có thể chạy nhiều containers nhưng ta sẽ tìm hiểu sau nhé.</li>
<li>Deployment: quản lý các pods, restart chúng nếu chúng bị crash.</li>
<li>Service: cung cấp một URL dễ nhớ để truy cập vào container.(chẳng hạn thay vì localhost:4001 thì URL sẽ là postservice)</li>
</ul>
<h2 id=một-vài-lưu-ý-với-config-files>Một vài lưu ý với config files.</h2>
<p><img src=/images/microservices-dg-68.png alt=microservices-dg-68></p>
<ul>
<li>
<p>Config files nói với Kubernetes về các deployments, pods và services khác nhau (chúng được xem như là các Objects) mà ta muốn tạo.</p>
</li>
<li>
<p>Được viết bằng YAML syntax.</p>
</li>
<li>
<p>Luôn lưu những config files này vào source code. Đây là document rất quan trọng, nó giúp cho enginner hiểu được cấu trúc dự án.</p>
</li>
<li>
<p>Ta có thể tạo được Kubernetes Objects mà không cần config files - tuy nhiên thì khuyến khích là không làm như vậy. Config files cung cấp định nghĩa chính xác cho Kubernetes việc cần làm, hơn nữa thì config files như đã nói thì nó cũng là document giúp người khác hiểu hơn về project.</p>
</li>
<li>
<p>Tài liệu của Kubernetes hướng dẫn bạn tạo objects bằng command - tuy nhiên thì chỉ nên làm vậy để test thôi nhé.</p>
</li>
</ul>
<h2 id=creating-a-pod>Creating a Pod</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-postservice:0.0.1</span>
</code></pre></div><p>Trước khi apply config file hãy chắc chắn là đang chạy 1 cluster trên máy của mình nhé. Nếu chưa thì sử dụng <code>minikube start</code> để tạo 1 cluster nhé.\</p>
<p>Lưu ý: Khi <code>minikube start</code> bạn sẽ tạo ra 1 máy ảo trên máy local của bạn, docker images trên local sẽ không tồn tại trên con VM này. Chính vì thế bạn có 2 cách: 1 là đẩy image bạn build từ local lên 1 registry nào đấy và VM sẽ pull từ đấy về, 2 là bạn sẽ build image ngay trong VM bằng cách sử dụng command <code>eval $(minikube docker-env)</code>, sau khi chạy command này ở 1 terminal cụ thể nào đấy, bạn có thể kiểm tra bằng <code>docker images</code>. Nếu thấy kết quả trả ra khác với local thì bạn có thể build image rồi đấy. Tham khảo thêm <a href=https://github.com/kubernetes/minikube/blob/0c616a6b42b28a1aab8397f5a9061f8ebbd9f3d9/README.md#reusing-the-docker-daemon>ở đây</a> nhé.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>docker build -t ducnguyen96/mini-microservice-postservice:0.0.1 .
</code></pre></div><p>Kiểm tra lại với <code>docker images</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl apply -f posts.yaml
</code></pre></div><p><img src=/images/microservices-dg-70.png alt=microservices-dg-70></p>
<h2 id=understanding-a-pod-spec>Understanding a Pod Spec</h2>
<p><img src=/images/microservices-dg-69.png alt=microservices-dg-69>
K8s có tính mở rộng cực kỳ cao, ta có thể tạo các Custom Objects.</p>
<ul>
<li>apiVersion: Phiên bản Kubernetes API mà chúng ta sẽ sử dụng để tạo object</li>
<li>kind: loại object</li>
<li>metadata: một số config options cho object, chẳng hạn name của Pod là posts.</li>
<li>spec: các thuộc tính của object mà ta sẽ tạo.</li>
<li>containers: 1 array các containers, mỗi container bắt đầu bằng -.</li>
</ul>
<p>Ở đây ta thấy tên pod và tên container trùng nhau, liệu có ảnh hưởng gì không, có phải bad practice không ?. Như bạn thấy thì Pod này chỉ có 1 container duy nhất là posts nên về mặt ngữ nghĩa thì cũng khá chính xác khi đặt tên pod trùng với tên container, tuy nhiên lúc pod có nhiều containers thì bạn có thể thay đổi tên pod cho hợp lý hơn, việc này cũng không ảnh hưởng gì nhiều (không gây lỗi.)</p>
<p>Một lưu ý với container image: nếu kubernetes không thấy image ở local thì nó sẽ mặc định tìm image ở Docker Hub, và nếu bạn không cung cấp version (0.0.1) thì mặc định nó sẽ pull image với tag lastest.</p>
<h2 id=common-kubectl-commands>Common Kubectl Commands</h2>
<p><img src=/images/microservices-dg-71.png alt=microservices-dg-71></p>
<h2 id=introducing-deployments>Introducing Deployments</h2>
<p><img src=/images/microservices-dg-72.png alt=microservices-dg-72>
Deployment là một object được tạo ra để quản lý các Pod. Deployment có 2 nhiệm vụ chính:</p>
<ul>
<li>Nếu có 1 pod bỗng nhiên bị crash thì deployment sẽ tự động tạo lại pod đó.</li>
<li>Chịu trách nhiệm update các phiên bản image mới hơn cho từng pod.</li>
</ul>
<h2 id=createing-a-deployments>Createing A Deployments</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts-depl</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>containers</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-postservice:0.0.1</span>
</code></pre></div><ul>
<li>selector: Nhìn vào tất cả pods, tìm pods nào có label của app là posts và quản lý chúng.</li>
<li>template: config pod</li>
<li>spec: pod spec</li>
</ul>
<h2 id=common-commands-around-deployments>Common Commands Around Deployments</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># List all the running deployments</span>
kubectl get deployments
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># Print out details about a specific deployment</span>
kubectl describe deployment <span style=color:#f92672>[</span>depl name<span style=color:#f92672>]</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># Create a deployment out of a config file</span>
kubectl apply f- <span style=color:#f92672>[</span>config file name<span style=color:#f92672>]</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># Delete a deployment</span>
kubectl delete deployment <span style=color:#f92672>[</span>depl name<span style=color:#f92672>]</span>
</code></pre></div><h2 id=networking-with-services>Networking With Services</h2>
<p><img src=/images/microservices-dg-74.png alt=microservices-dg-74>
Để các pod có thể giao tiếp với nhau và bên ngoài có thể giao tiếp với pod thì kubernetes cung cấp cho ta 1 loại object để thực hiện việc này - service.</p>
<p>Có một số loại services sau đây:
<img src=/images/microservices-dg-75.png alt=microservices-dg-75></p>
<ul>
<li>Cluster IP: truy cập vào pods trong cùng 1 cluster.</li>
<li>Node Port: truy cập vào pod từ bên ngoài, thường sử dụng cho dev env.</li>
<li>Load Balancer: truy cập vào pod từ bên ngoài.</li>
<li>External Name: thường rất được sử dụng cho 1 vài trường hợp đặc biệt.</li>
</ul>
<h2 id=creating-a-nodeport-service>Creating A NodePort Service</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#75715e># posts-srv.yml</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts-srv</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
  <span style=color:#f92672>ports</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>4000</span>
      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>4000</span>
</code></pre></div><p>Ở phần trên ta đã tạo 1 Deployment với metadata chứa labels: <code>app: posts</code>. Giờ ta muốn expose những pod của delpoyment đó ra ngoài để có thể access từ browser, thì service mới tạo này có selector là <code>app: posts</code> nó sẽ tìm tất cả các pod có label này để áp dụng config.</p>
<p><img src=/images/microservices-dg-76.png alt=microservices-dg-76>
Theo hình trên ta có thể thấy, Node là một máy ảo đang chạy các kubernetes objects là NodePort Service và Pod. Pod của chúng ta đang chạy image của post service, nó dang listen ở cổng 4000. NodePort Service là 1 object riêng giúp ta giao tiếp với Pod, và nó cũng có 1 port riêng</p>
<p>Để giao tiếp được với pod thì trước tiên ta phải qua Node sau đó đến NodePort service. Để xem địa chỉ ip của Node minikube ta sẽ inspect container minikube.</p>
<p><img src=/images/microservices-dg-77.png alt=microservices-dg-77></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>docker inspect 0d8db750f273
</code></pre></div><p><img src=/images/microservices-dg-78.png alt=microservices-dg-78></p>
<p>Kéo xuống phần network ta có thể thấy được địa chỉ ip của minikube.</p>
<p><img src=/images/microservices-dg-79.png alt=microservices-dg-79>
Vậy giờ ta có thể giao tiếp được với pod posts qua <code>192.168.49.2:31331</code>
<img src=/images/microservices-dg-80.png alt=microservices-dg-80></p>
<h2 id=setting-up-cluster-ip-services>Setting Up Cluster IP Services</h2>
<p>Mục đích của Cluster IP là expose 1 pod đến những pods khác trong cùng 1 cluster. Trước hết ta hãy xem lại cách app của chúng ta hoạt động đã nhá.</p>
<p>Khi người dùng muốn tạo post, ta sẽ emit 1 event đến event bus, sau đấy thì event sẽ emit event đó đến toàn bộ pods kể cả post để tạo post.</p>
<p>Về mặt kỹ thuật thì các pod có thể giao tiếp trực tiếp với nhau nhưng chúng sẽ có ip ngẫu nhiên và khó nhớ, có thể thay đổi sau những lần update. Vì thế các pod sẽ giao tiếp với nhau qua cluster ip.</p>
<h3 id=building-a-deployment-and-clusterip-for-the-event-bus>Building A Deployment and ClusterIP For The Event Bus</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>event-bus-depl</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>event-bus</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>event-bus</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>containers</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>event-bus</span>
          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-eventbus:0.0.1</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>event-bus-srv</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>event-bus</span>
  <span style=color:#f92672>ports</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>event-bus</span>
      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>4005</span>
      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>4005</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl apply -f event-bus-depl.yml
</code></pre></div><p>Ta có thể tách từng file riêng cho từng kebernetes objects, tuy nhiên ở đây mình prefer gộp lại là 1 hơn.</p>
<p>Tương tự thì ta cũng thêm ClusterIP cho postservice</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts-depl</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>containers</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-postservice:0.0.1</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts-clusterip-srv</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>posts</span>
  <span style=color:#f92672>ports</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts</span>
      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>4000</span>
      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>4000</span>
</code></pre></div><h2 id=communicate-between-services>Communicate Between Services</h2>
<p>Mặc dù minikube đang chạy trên máy local nhưng các pod trong minikube thì không thể giao tiếp với nhau qua localhost, hiện tại ta đã tạo ClusterIP cho postservice và eventbus, 2 pod này có thể giao tiếp với nhau qua ClusterIP, vậy ta phải thay đổi địa chỉ IP của chúng như sau:
<img src=/images/microservices-dg-81.png alt=microservices-dg-81>
Post muốn gửi request đến eventbus (port 4005) thay vì <code>localhost:4005</code> thì ta thay bằng <code>http://event-bus-srv:4005</code></p>
<h2 id=load-balancer-services>Load Balancer Services</h2>
<p><img src=/images/microservices-dg-82.png alt=microservices-dg-82>
Ở Initial load page, với client-side-rendering app như create-react-app thì server chỉ trả về HTML + JS + CSS chưa kèm data, nên chúng ta chưa cần quan tâm đến việc giao tiếp giữa client và các services khác.</p>
<p>Tuy nhiên, khi đã load được html + js rồi, user requests posts thì lúc này ta cần giao tiếp giữa react-app và các services khác như posts, comments. Ta có 2 cách giải quyết như sau:</p>
<p><img src=/images/microservices-dg-83.png alt=microservices-dg-83>
Cách đầu tiên như ở phía trên đã có ví dụ về posts, mỗi pod sẽ được gắn với 1 node port riêng và với từng request thì react-app sẽ gửi đến từng port khác nhau. Tuy nhiên như bạn đang nghĩ đấy, với mỗi nodeport thì kubernetes sẽ random gán với 1 port, sẽ thế nào nếu 1 lúc nào đó port này bị đổi ? bạn sẽ phải đến react-app code và thay đổi từng request một.</p>
<p><img src=/images/microservices-dg-84.png alt=microservices-dg-84>
Cách thứ 2 là sử dụng load balancer - chủ đề của phần này. Ta sẽ có 1 endpoint duy nhất để react-app kết nối đến và balancer này sẽ map từng request đến từng pod cần thiết.</p>
<h3 id=load-balancers-and-ingress>Load Balancers and Ingress</h3>
<p><img src=/images/microservices-dg-85.png alt=microservices-dg-85></p>
<ul>
<li>Hiểu một cách đơn giản thì Load Balancer giúp route request từ bên ngoài đến cluster.</li>
<li>Ingress là pod trong kubernetes nhận request từ loadbalancer và route đến từng pod cụ thể.</li>
</ul>
<h3 id=ingress-nginx>ingress-nginx</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>minikube addons enable ingress
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ingress-srv</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>ingress-nginx</span>
  <span style=color:#f92672>annotations</span>:
    <span style=color:#f92672>kubernetes.io/ingress.class</span>: <span style=color:#ae81ff>nginx</span>
    <span style=color:#f92672>nginx.ingress.kubernetes.io/use-regex</span>: <span style=color:#e6db74>&#34;true&#34;</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>rules</span>:
    - <span style=color:#f92672>host</span>: <span style=color:#ae81ff>posts.com</span>
      <span style=color:#f92672>http</span>:
        <span style=color:#f92672>paths</span>:
          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/posts/create</span>
            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
            <span style=color:#f92672>backend</span>:
              <span style=color:#f92672>service</span>:
                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>posts-clusterip-srv</span>
                <span style=color:#f92672>port</span>:
                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>4000</span>
          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/posts</span>
            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
            <span style=color:#f92672>backend</span>:
              <span style=color:#f92672>service</span>:
                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>query-clusterip-srv</span>
                <span style=color:#f92672>port</span>:
                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>4002</span>
          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>posts/?(.*)/comments</span>
            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
            <span style=color:#f92672>backend</span>:
              <span style=color:#f92672>service</span>:
                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>comment-clusterip-srv</span>
                <span style=color:#f92672>port</span>:
                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>4001</span>
          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/?(.*)</span>
            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
            <span style=color:#f92672>backend</span>:
              <span style=color:#f92672>service</span>:
                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>client-clusterip-srv</span>
                <span style=color:#f92672>port</span>:
                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>3000</span>
</code></pre></div><p>Finish Route Config. Lưu ý thì ingress-nginx không có rules để phân biệt request methods: POST, GET, vì vậy ta phải có unique path.
<img src=/images/microservices-dg-86.png alt=microservices-dg-86></p>
<p>Sau khi đã config xong toàn bộ, ta apply config:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl apply -f ../k8s -n<span style=color:#f92672>=</span>ingress-nginx
</code></pre></div><p>Lấy ip của ingress</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get ingress -n<span style=color:#f92672>=</span>ingress-nginx
</code></pre></div><p><img src=/images/microservices-dg-87.png alt=microservices-dg-87></p>
<p>Update ip vào hosts file <code>/etc/hosts</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo nano /etc/hosts
</code></pre></div><p><img src=/images/microservices-dg-88.png alt=microservices-dg-88></p>
<p>Vậy là app của ta được deploy và chạy ngon lành rồi 💓. Tuy nhiên quá trình development thì trải nghiệm không được tốt, vì mỗi lần update code ta lại phải build image rồi sửa config file xong mới deploy để test kết quả.</p>
<p>Để giải quyết vấn đề này thì sinh ra 1 tool là <code>Skaffold</code>.</p>
<h2 id=skaffold>Skaffold</h2>
<h3 id=installation>Installation</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>curl -Lo skaffold https://storage.googleapis.com/skaffold/releases/latest/skaffold-linux-amd64 <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>sudo install skaffold /usr/local/bin/
</code></pre></div><p>Config Skaffold</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>skaffold/v2beta21</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Config</span>
<span style=color:#f92672>deploy</span>:
  <span style=color:#f92672>kubectl</span>:
    <span style=color:#f92672>manifests</span>:
      - <span style=color:#ae81ff>./infa/k8s/*</span>
<span style=color:#f92672>build</span>:
  <span style=color:#f92672>local</span>:
    <span style=color:#f92672>push</span>: <span style=color:#66d9ef>false</span>
  <span style=color:#f92672>artifacts</span>:
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-client</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>client</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-commentservice</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>comments</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-eventbus</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>events</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-moderationservice</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>moderation</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-postservice</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>posts</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ducnguyen96/mini-microservice-queryservice</span>
      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>query</span>
      <span style=color:#f92672>docker</span>:
        <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
      <span style=color:#f92672>sync</span>:
        <span style=color:#f92672>manual</span>:
          - <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;src/**/*.js&#34;</span>
            <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>.</span>
</code></pre></div>
</div>
</article>
<div class=blog-post-comments>
<div id=disqus_thread>
<script type=text/javascript>(function(){var a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,b='ducnguyen96',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</div>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li><a href=#installing-kubernetes>Installing Kubernetes</a></li>
<li><a href=#a-quick-kubernetes-tour>A Quick Kubernetes Tour</a></li>
<li><a href=#những-thuật-ngữ-quan-trọng-trong-kubernetes>Những thuật ngữ quan trọng trong Kubernetes</a></li>
<li><a href=#một-vài-lưu-ý-với-config-files>Một vài lưu ý với config files.</a></li>
<li><a href=#creating-a-pod>Creating a Pod</a></li>
<li><a href=#understanding-a-pod-spec>Understanding a Pod Spec</a></li>
<li><a href=#common-kubectl-commands>Common Kubectl Commands</a></li>
<li><a href=#introducing-deployments>Introducing Deployments</a></li>
<li><a href=#createing-a-deployments>Createing A Deployments</a></li>
<li><a href=#common-commands-around-deployments>Common Commands Around Deployments</a></li>
<li><a href=#networking-with-services>Networking With Services</a></li>
<li><a href=#creating-a-nodeport-service>Creating A NodePort Service</a></li>
<li><a href=#setting-up-cluster-ip-services>Setting Up Cluster IP Services</a>
<ul>
<li><a href=#building-a-deployment-and-clusterip-for-the-event-bus>Building A Deployment and ClusterIP For The Event Bus</a></li>
</ul>
</li>
<li><a href=#communicate-between-services>Communicate Between Services</a></li>
<li><a href=#load-balancer-services>Load Balancer Services</a>
<ul>
<li><a href=#load-balancers-and-ingress>Load Balancers and Ingress</a></li>
<li><a href=#ingress-nginx>ingress-nginx</a></li>
</ul>
</li>
<li><a href=#skaffold>Skaffold</a>
<ul>
<li><a href=#installation>Installation</a></li>
</ul>
</li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f" aria-label=Facebook>
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&text=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&is_video=false&description=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Pinterest>
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes&body=Check out this article: %2fposts%2fbackend%2fmicroservices-with-node-p4%2f" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&title=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&name=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes&description=Installing%20Kubernetes%20C%c3%a0i%20%c4%91%e1%ba%b7t%20theo%20%e1%bb%9f%20%c4%91%c3%a2y%20nh%c3%a9.%0aL%c6%b0u%20%c3%bd%3a%20Sau%20khi%20c%c3%a0i%20%c4%91%e1%ba%b7t%20kubectl%2c%20%c4%91%e1%bb%83%20ch%e1%ba%a1y%201%20cluster%20tr%c3%aan%20m%c3%a1y%20local%20c%e1%bb%a7a%20b%e1%ba%a1n%20th%c3%ac%20ta%20s%e1%ba%bd%20s%e1%bb%ad%20d%e1%bb%a5ng%20th%c3%aam%201%20tool%20g%e1%bb%8di%20l%c3%a0%20minikube.%20B%e1%ba%a1n%20%c4%91%e1%bb%8dc%20t%c3%acm%20hi%e1%bb%83u%20th%c3%aam%20%e1%bb%9f%20%c4%91%c3%a2y%0aA%20Quick%20Kubernetes%20Tour%20Nh%e1%bb%afng%20thu%e1%ba%adt%20ng%e1%bb%af%20quan%20tr%e1%bb%8dng%20trong%20Kubernetes%20%20Kubernetes%20Cluster%20bao%20g%e1%bb%93m%20m%e1%bb%99t%20ho%e1%ba%b7c%20nhi%e1%bb%81u%20nodes%20%28m%e1%bb%97i%20node%20l%c3%a0%20m%e1%bb%99t%20m%c3%a1y%20%e1%ba%a3o%29%20v%c3%a0%201%20Master%20%c4%91%e1%bb%83%20qu%e1%ba%a3n%20l%c3%bd%20c%c3%a1c%20nodes." aria-label=Tumblr>
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fbackend%2fmicroservices-with-node-p4%2f&t=Microservices%20v%e1%bb%9bi%20NodeJS%20ph%e1%ba%a7n%204%20-%20%c4%90i%e1%bb%81u%20ph%e1%bb%91i%20services%20v%e1%bb%9bi%20Kubernetes" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2021 ducnguyen96
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
</html>
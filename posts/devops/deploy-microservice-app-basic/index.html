<!doctype html><html lang=vi-vn>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Deploy microservices app trên AWS EKS | Thỉnh thoảng đôi lời</title>
<link rel=canonical href=/posts/devops/deploy-microservice-app-basic/>
<meta name=description content="Là nơi chia sẻ lại những kiến thức, kinh nghiệm mình tiếp thu được trong quá trình học tập và làm việc. Và thỉnh thoảng cũng đăng một vài demo ngớ ngẩn nữa :smile:">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="Deploy microservices app trên AWS EKS">
<meta property="og:description" content="Lưu ý: bài này phục vụ mục đích test là chủ yếu, images cho app của mình public trên dockerhub nên không cần config thêm về registry, credential các thứ.
Install the AWS CLI version 2 on Linux Xem thêm tại đây
curl &#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&#34; -o &#34;awscliv2.zip&#34; unzip awscliv2.zip sudo ./aws/install Config AWS CLI Truy cập vào IAM thêm permissions và tạo credentials ở tab Security Credentials.
nano ~/.aws/credentials
[default] region=ap-southeast-1 aws_access_key_id=your-access-key-id aws_secret_access_key=your-secret Install eksctl Tải bản build sẵn ở đây">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/devops/deploy-microservice-app-basic/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-09-29T00:00:00+00:00">
<meta property="article:modified_time" content="2021-09-29T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Deploy microservices app trên AWS EKS">
<meta name=twitter:description content="Lưu ý: bài này phục vụ mục đích test là chủ yếu, images cho app của mình public trên dockerhub nên không cần config thêm về registry, credential các thứ.
Install the AWS CLI version 2 on Linux Xem thêm tại đây
curl &#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&#34; -o &#34;awscliv2.zip&#34; unzip awscliv2.zip sudo ./aws/install Config AWS CLI Truy cập vào IAM thêm permissions và tạo credentials ở tab Security Credentials.
nano ~/.aws/credentials
[default] region=ap-southeast-1 aws_access_key_id=your-access-key-id aws_secret_access_key=your-secret Install eksctl Tải bản build sẵn ở đây">
<link rel=stylesheet href=/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=/images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=/posts/backend/microservices-with-node-p20/ aria-label=Previous>
<i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f" aria-label=Facebook>
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&text=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&title=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&is_video=false&description=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label=Pinterest>
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS&body=Check out this article: %2fposts%2fdevops%2fdeploy-microservice-app-basic%2f" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&title=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&title=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&name=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS&description=L%c6%b0u%20%c3%bd%3a%20b%c3%a0i%20n%c3%a0y%20ph%e1%bb%a5c%20v%e1%bb%a5%20m%e1%bb%a5c%20%c4%91%c3%adch%20test%20l%c3%a0%20ch%e1%bb%a7%20y%e1%ba%bfu%2c%20images%20cho%20app%20c%e1%bb%a7a%20m%c3%acnh%20public%20tr%c3%aan%20dockerhub%20n%c3%aan%20kh%c3%b4ng%20c%e1%ba%a7n%20config%20th%c3%aam%20v%e1%bb%81%20registry%2c%20credential%20c%c3%a1c%20th%e1%bb%a9.%0aInstall%20the%20AWS%20CLI%20version%202%20on%20Linux%20Xem%20th%c3%aam%20t%e1%ba%a1i%20%c4%91%c3%a2y%0acurl%20%26%2334%3bhttps%3a%2f%2fawscli.amazonaws.com%2fawscli-exe-linux-x86_64.zip%26%2334%3b%20-o%20%26%2334%3bawscliv2.zip%26%2334%3b%20unzip%20awscliv2.zip%20sudo%20.%2faws%2finstall%20Config%20AWS%20CLI%20Truy%20c%e1%ba%adp%20v%c3%a0o%20IAM%20th%c3%aam%20permissions%20v%c3%a0%20t%e1%ba%a1o%20credentials%20%e1%bb%9f%20tab%20Security%20Credentials.%0anano%20~%2f.aws%2fcredentials%0a%5bdefault%5d%20region%3dap-southeast-1%20aws_access_key_id%3dyour-access-key-id%20aws_secret_access_key%3dyour-secret%20Install%20eksctl%20T%e1%ba%a3i%20b%e1%ba%a3n%20build%20s%e1%ba%b5n%20%e1%bb%9f%20%c4%91%c3%a2y" aria-label=Tumblr>
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&t=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#install-the-aws-cli-version-2-on-linux>Install the AWS CLI version 2 on Linux</a></li>
<li><a href=#config-aws-cli>Config AWS CLI</a></li>
<li><a href=#install-eksctl>Install eksctl</a></li>
<li><a href=#tạo-cluster-với-eksctl>Tạo cluster với eksctl</a></li>
<li><a href=#cài-đặt-helm>Cài đặt helm</a></li>
<li><a href=#cài-đặt-ingress-controller-với-helm>Cài đặt ingress controller với helm</a></li>
<li><a href=#deploy-microservices-app>Deploy microservices app</a></li>
<li><a href=#sau-khi-có-controller-thi-thêm-ingress-cho-app-của-mình-thôi->Sau khi có controller thi thêm ingress cho app của mình thôi 😃</a></li>
<li><a href=#config-dns>Config DNS</a></li>
<li><a href=#cài-đặt-cert-manager>Cài đặt cert-manager</a></li>
<li><a href=#configure-lets-encrypt-issuer>Configure Let’s Encrypt Issuer</a></li>
<li><a href=#thêm-tls-cho-ingress>Thêm TLS cho ingress</a></li>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
Deploy microservices app trên AWS EKS
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2021-09-29 00:00:00 +0000 UTC" itemprop=datePublished>2021-09-29</time>
</div>
<div class=article-category>
<i class="fas fa-archive"></i>
<a class=category-link href=/categories/devops>devops</a>
,
<a class=category-link href=/categories/backend>backend</a>
</div>
<div class=article-tag>
<i class="fas fa-tag"></i>
<a class=tag-link href=/tags/backend rel=tag>backend</a>
,
<a class=tag-link href=/tags/devops rel=tag>devops</a>
,
<a class=tag-link href=/tags/aws rel=tag>aws</a>
,
<a class=tag-link href=/tags/helm rel=tag>helm</a>
,
<a class=tag-link href=/tags/eksctl rel=tag>eksctl</a>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<p>Lưu ý: bài này phục vụ mục đích test là chủ yếu, images cho app của mình public trên dockerhub nên không cần config thêm về registry, credential các thứ.</p>
<h2 id=install-the-aws-cli-version-2-on-linux>Install the AWS CLI version 2 on Linux</h2>
<p>Xem thêm tại <a href=https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html#cliv2-linux-install>đây</a></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>curl <span style=color:#e6db74>&#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&#34;</span> -o <span style=color:#e6db74>&#34;awscliv2.zip&#34;</span>
unzip awscliv2.zip
sudo ./aws/install
</code></pre></div><h2 id=config-aws-cli>Config AWS CLI</h2>
<p>Truy cập vào <a href=https://console.aws.amazon.com/iamv2/home?#/users>IAM</a> thêm permissions và tạo credentials ở tab <code>Security Credentials</code>.</p>
<p><code>nano ~/.aws/credentials</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>[</span>default<span style=color:#f92672>]</span>
region<span style=color:#f92672>=</span>ap-southeast-1
aws_access_key_id<span style=color:#f92672>=</span>your-access-key-id
aws_secret_access_key<span style=color:#f92672>=</span>your-secret
</code></pre></div><h2 id=install-eksctl>Install eksctl</h2>
<p>Tải bản build sẵn ở <a href=https://github.com/weaveworks/eksctl/releases>đây</a></p>
<p>Unpack và move file bin tới <code>/usr/local/bin</code></p>
<h2 id=tạo-cluster-với-eksctl>Tạo cluster với eksctl</h2>
<p>Ở đây mình dùng <code>t3.small</code> vì <code>t2.micro</code> quá yếu, không đủ RAM để chạy.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># eksctl-cluster.yaml</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>eksctl.io/v1alpha5</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterConfig</span>

<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ducnguyen96</span>
  <span style=color:#f92672>region</span>: <span style=color:#ae81ff>ap-southeast-1</span>
  <span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;1.21&#34;</span>

<span style=color:#f92672>nodeGroups</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>linux-nodes</span>
    <span style=color:#f92672>labels</span>:
      <span style=color:#f92672>role</span>: <span style=color:#ae81ff>workers</span>
    <span style=color:#f92672>instanceType</span>: <span style=color:#ae81ff>t3.small</span>
    <span style=color:#f92672>desiredCapacity</span>: <span style=color:#ae81ff>2</span>
</code></pre></div><p>Tạo cluster với <code>eksctl</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>eks create cluster -f eksctl-cluster.yaml
</code></pre></div><p>Lưu ý: quá trình tạo cluster diễn ra khá là lâu (rất lâu 😢) khoảng 20-30 phút gì đấy, nếu không báo lỗi thì chịu khó đợi nhé.</p>
<p>Tiếp theo ta sẽ dùng 1 công cụ (helm) để cài <code>ingress-controller</code></p>
<h2 id=cài-đặt-helm>Cài đặt helm</h2>
<p>Lưu ý: nên tải helm v3++ để cài ingress nginx</p>
<ul>
<li>Tải bản built ở <a href=https://github.com/helm/helm/releases>đây</a></li>
<li>Unpack và move file bin tới <code>/usr/local/bin</code></li>
</ul>
<p>Chi tiết xem thêm ở <a href=https://helm.sh/docs/intro/install/>đây</a></p>
<h2 id=cài-đặt-ingress-controller-với-helm>Cài đặt ingress controller với helm</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update
</code></pre></div><p>Config ingress qua file <code>values.yaml</code> ở <a href=https://github.com/kubernetes/ingress-nginx/blob/main/charts/ingress-nginx/values.yaml>đây</a></p>
<p>Sau khi config xong thì cài đặt controller thôi 😄</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>helm install sample-ingress ingress-nginx/ingress-nginx -f values.yaml
</code></pre></div><h2 id=deploy-microservices-app>Deploy microservices app</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>k8s/
├─ api-gateway-depl.yaml
├─ api-gateway-postgres-depl.yaml
├─ user-depl.yaml
├─ user-postgres-depl.yaml
</code></pre></div><p>Demo của mình tạm thời có 4 deployments chứa 1 <code>api-gateway</code> và 1 service <code>user</code>, cả 2 đều có sử dụng database riêng là postgres database.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl apply -f k8s
</code></pre></div><h2 id=sau-khi-có-controller-thi-thêm-ingress-cho-app-của-mình-thôi->Sau khi có controller thi thêm ingress cho app của mình thôi 😃</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># ingress-srv.yaml</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ingress-srv</span>
  <span style=color:#f92672>annotations</span>:
    <span style=color:#f92672>kubernetes.io/ingress.class</span>: <span style=color:#ae81ff>nginx</span>
    <span style=color:#f92672>nginx.ingress.kubernetes.io/use-regex</span>: <span style=color:#e6db74>&#34;true&#34;</span>
    <span style=color:#75715e># cert-manager.io/issuer: &#34;letsencrypt-cluster-issuer&#34;</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#75715e># tls:</span>
  <span style=color:#75715e>#   - hosts:</span>
  <span style=color:#75715e>#       - ducnguyen96.xyz</span>
  <span style=color:#75715e>#     secretName: tls-secret</span>
  <span style=color:#f92672>rules</span>:
    - <span style=color:#f92672>host</span>: <span style=color:#ae81ff>ducnguyen96.xyz</span>
      <span style=color:#f92672>http</span>:
        <span style=color:#f92672>paths</span>:
          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/graphql</span>
            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
            <span style=color:#f92672>backend</span>:
              <span style=color:#f92672>service</span>:
                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>api-gateway-srv</span>
                <span style=color:#f92672>port</span>:
                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>3000</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl apply -f ingress-srv.yaml
</code></pre></div><h2 id=config-dns>Config DNS</h2>
<p>Để lấy được ip của cluster thì sử dụng 1 trong 2 command dưới đây</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl cluster-info
</code></pre></div><p>hoặc xem ip của ingress controller</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl get services --all-namespaces
</code></pre></div><h2 id=cài-đặt-cert-manager>Cài đặt cert-manager</h2>
<p>Xem thêm ở <a href=https://cert-manager.io/docs/installation/>đây</a></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.5.3/cert-manager.yaml
</code></pre></div><h2 id=configure-lets-encrypt-issuer>Configure Let’s Encrypt Issuer</h2>
<p>Xem thêm ở <a href=https://cert-manager.io/docs/tutorials/acme/ingress/#step-6-configure-let-s-encrypt-issuer>đây</a></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># issuer.yaml</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cert-manager.io/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Issuer</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>letsencrypt-cluster-issuer</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>acme</span>:
    <span style=color:#f92672>server</span>: <span style=color:#ae81ff>https://acme-v02.api.letsencrypt.org/directory</span>
    <span style=color:#f92672>email</span>: <span style=color:#ae81ff>your-email@email.com</span>
    <span style=color:#f92672>privateKeySecretRef</span>:
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>letsencrypt-cluster-issuer-key</span>
    <span style=color:#f92672>solvers</span>:
      - <span style=color:#f92672>http01</span>:
          <span style=color:#f92672>ingress</span>:
            <span style=color:#f92672>class</span>: <span style=color:#ae81ff>nginx</span>
</code></pre></div><p>Tạo Issuer với kubectl</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl create -f issuer.yaml
</code></pre></div><h2 id=thêm-tls-cho-ingress>Thêm TLS cho ingress</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># ingress-srv.yaml</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ingress-srv</span>
  <span style=color:#f92672>annotations</span>:
    <span style=color:#f92672>kubernetes.io/ingress.class</span>: <span style=color:#ae81ff>nginx</span>
    <span style=color:#f92672>nginx.ingress.kubernetes.io/use-regex</span>: <span style=color:#e6db74>&#34;true&#34;</span>
    <span style=color:#f92672>cert-manager.io/issuer</span>: <span style=color:#e6db74>&#34;letsencrypt-cluster-issuer&#34;</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>tls</span>:
    - <span style=color:#f92672>hosts</span>:
        - <span style=color:#ae81ff>ducnguyen96.xyz</span>
      <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>tls-secret</span>
  <span style=color:#f92672>rules</span>:
    - <span style=color:#f92672>host</span>: <span style=color:#ae81ff>ducnguyen96.xyz</span>
      <span style=color:#f92672>http</span>:
        <span style=color:#f92672>paths</span>:
          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/graphql</span>
            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
            <span style=color:#f92672>backend</span>:
              <span style=color:#f92672>service</span>:
                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>api-gateway-srv</span>
                <span style=color:#f92672>port</span>:
                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>3000</span>
</code></pre></div><p>Apply thôi</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl apply -f ingress-srv.yaml
</code></pre></div><p>Vậy là ta đã deploy xong 1 microservices app trêm EKS rồi 😍</p>
</div>
</article>
<div class=blog-post-comments>
<div id=disqus_thread>
<script type=text/javascript>(function(){var a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,b='ducnguyen96',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</div>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li><a href=#install-the-aws-cli-version-2-on-linux>Install the AWS CLI version 2 on Linux</a></li>
<li><a href=#config-aws-cli>Config AWS CLI</a></li>
<li><a href=#install-eksctl>Install eksctl</a></li>
<li><a href=#tạo-cluster-với-eksctl>Tạo cluster với eksctl</a></li>
<li><a href=#cài-đặt-helm>Cài đặt helm</a></li>
<li><a href=#cài-đặt-ingress-controller-với-helm>Cài đặt ingress controller với helm</a></li>
<li><a href=#deploy-microservices-app>Deploy microservices app</a></li>
<li><a href=#sau-khi-có-controller-thi-thêm-ingress-cho-app-của-mình-thôi->Sau khi có controller thi thêm ingress cho app của mình thôi 😃</a></li>
<li><a href=#config-dns>Config DNS</a></li>
<li><a href=#cài-đặt-cert-manager>Cài đặt cert-manager</a></li>
<li><a href=#configure-lets-encrypt-issuer>Configure Let’s Encrypt Issuer</a></li>
<li><a href=#thêm-tls-cho-ingress>Thêm TLS cho ingress</a></li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f" aria-label=Facebook>
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&text=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&title=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&is_video=false&description=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label=Pinterest>
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS&body=Check out this article: %2fposts%2fdevops%2fdeploy-microservice-app-basic%2f" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&title=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&title=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&name=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS&description=L%c6%b0u%20%c3%bd%3a%20b%c3%a0i%20n%c3%a0y%20ph%e1%bb%a5c%20v%e1%bb%a5%20m%e1%bb%a5c%20%c4%91%c3%adch%20test%20l%c3%a0%20ch%e1%bb%a7%20y%e1%ba%bfu%2c%20images%20cho%20app%20c%e1%bb%a7a%20m%c3%acnh%20public%20tr%c3%aan%20dockerhub%20n%c3%aan%20kh%c3%b4ng%20c%e1%ba%a7n%20config%20th%c3%aam%20v%e1%bb%81%20registry%2c%20credential%20c%c3%a1c%20th%e1%bb%a9.%0aInstall%20the%20AWS%20CLI%20version%202%20on%20Linux%20Xem%20th%c3%aam%20t%e1%ba%a1i%20%c4%91%c3%a2y%0acurl%20%26%2334%3bhttps%3a%2f%2fawscli.amazonaws.com%2fawscli-exe-linux-x86_64.zip%26%2334%3b%20-o%20%26%2334%3bawscliv2.zip%26%2334%3b%20unzip%20awscliv2.zip%20sudo%20.%2faws%2finstall%20Config%20AWS%20CLI%20Truy%20c%e1%ba%adp%20v%c3%a0o%20IAM%20th%c3%aam%20permissions%20v%c3%a0%20t%e1%ba%a1o%20credentials%20%e1%bb%9f%20tab%20Security%20Credentials.%0anano%20~%2f.aws%2fcredentials%0a%5bdefault%5d%20region%3dap-southeast-1%20aws_access_key_id%3dyour-access-key-id%20aws_secret_access_key%3dyour-secret%20Install%20eksctl%20T%e1%ba%a3i%20b%e1%ba%a3n%20build%20s%e1%ba%b5n%20%e1%bb%9f%20%c4%91%c3%a2y" aria-label=Tumblr>
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fdevops%2fdeploy-microservice-app-basic%2f&t=Deploy%20microservices%20app%20tr%c3%aan%20AWS%20EKS" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2021 ducnguyen96
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
</html>